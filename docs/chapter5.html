<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rで機械学習！ - 教師あり学習 : 回帰</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter6.html" rel="next">
<link href="./chapter4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter4.html">内容</a></li><li class="breadcrumb-item"><a href="./chapter5.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">教師あり学習 : 回帰</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Rで機械学習！</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/Honoka-Nakano/MachineLearningWithR/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">紹介</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">内容</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">機械学習に必要な数学の基本</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">教師あり学習 : 回帰</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">教師あり学習 : 分類</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">ニューラルネットワーク・ディープラーニング</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">NNW, DLの応用(手書き数字の認識)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">教師なし学習</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#準備" id="toc-準備" class="nav-link active" data-scroll-target="#準備">準備</a></li>
  <li><a href="#内容" id="toc-内容" class="nav-link" data-scroll-target="#内容">内容</a>
  <ul>
  <li><a href="#第1節" id="toc-第1節" class="nav-link" data-scroll-target="#第1節">第1節</a>
  <ul class="collapse">
  <li><a href="#リスト-5-1-1" id="toc-リスト-5-1-1" class="nav-link" data-scroll-target="#リスト-5-1-1">リスト 5-1-(1)</a></li>
  <li><a href="#リスト-5-1-2" id="toc-リスト-5-1-2" class="nav-link" data-scroll-target="#リスト-5-1-2">リスト 5-1-(2)</a></li>
  <li><a href="#リスト-5-1-3" id="toc-リスト-5-1-3" class="nav-link" data-scroll-target="#リスト-5-1-3">リスト 5-1-(3)</a></li>
  <li><a href="#リスト-5-1-4" id="toc-リスト-5-1-4" class="nav-link" data-scroll-target="#リスト-5-1-4">リスト 5-1-(4)</a></li>
  <li><a href="#リスト-5-1-5" id="toc-リスト-5-1-5" class="nav-link" data-scroll-target="#リスト-5-1-5">リスト 5-1-(5)</a></li>
  <li><a href="#リスト-5-1-6" id="toc-リスト-5-1-6" class="nav-link" data-scroll-target="#リスト-5-1-6">リスト 5-1-(6)</a></li>
  <li><a href="#リスト-5-1-7" id="toc-リスト-5-1-7" class="nav-link" data-scroll-target="#リスト-5-1-7">リスト 5-1-(7)</a></li>
  <li><a href="#リスト-5-1-8" id="toc-リスト-5-1-8" class="nav-link" data-scroll-target="#リスト-5-1-8">リスト 5-1-(8)</a></li>
  <li><a href="#リスト-5-1-9" id="toc-リスト-5-1-9" class="nav-link" data-scroll-target="#リスト-5-1-9">リスト 5-1-(9)</a></li>
  <li><a href="#リスト-5-1-10" id="toc-リスト-5-1-10" class="nav-link" data-scroll-target="#リスト-5-1-10">リスト 5-1-(10)</a></li>
  <li><a href="#リスト-5-1-11" id="toc-リスト-5-1-11" class="nav-link" data-scroll-target="#リスト-5-1-11">リスト 5-1-(11)</a></li>
  </ul></li>
  <li><a href="#第2節" id="toc-第2節" class="nav-link" data-scroll-target="#第2節">第2節</a>
  <ul class="collapse">
  <li><a href="#リセット" id="toc-リセット" class="nav-link" data-scroll-target="#リセット">リセット</a></li>
  <li><a href="#リスト-5-2-1" id="toc-リスト-5-2-1" class="nav-link" data-scroll-target="#リスト-5-2-1">リスト 5-2-(1)</a></li>
  <li><a href="#リスト-5-2-2" id="toc-リスト-5-2-2" class="nav-link" data-scroll-target="#リスト-5-2-2">リスト 5-2-(2)</a></li>
  <li><a href="#リスト-5-2-3" id="toc-リスト-5-2-3" class="nav-link" data-scroll-target="#リスト-5-2-3">リスト 5-2-(3)</a></li>
  <li><a href="#リスト-5-2-4" id="toc-リスト-5-2-4" class="nav-link" data-scroll-target="#リスト-5-2-4">リスト 5-2-(4)</a></li>
  <li><a href="#リスト-5-2-5" id="toc-リスト-5-2-5" class="nav-link" data-scroll-target="#リスト-5-2-5">リスト 5-2-(5)</a></li>
  </ul></li>
  <li><a href="#第3節" id="toc-第3節" class="nav-link" data-scroll-target="#第3節">第3節</a>
  <ul class="collapse">
  <li><a href="#リセット-1" id="toc-リセット-1" class="nav-link" data-scroll-target="#リセット-1">リセット</a></li>
  <li><a href="#リスト-5-3-1" id="toc-リスト-5-3-1" class="nav-link" data-scroll-target="#リスト-5-3-1">リスト 5-3-(1)</a></li>
  <li><a href="#リスト-5-3-2" id="toc-リスト-5-3-2" class="nav-link" data-scroll-target="#リスト-5-3-2">リスト 5-3-(2)</a></li>
  <li><a href="#リスト-5-3-3" id="toc-リスト-5-3-3" class="nav-link" data-scroll-target="#リスト-5-3-3">リスト 5-3-(3)</a></li>
  <li><a href="#リスト-5-3-4" id="toc-リスト-5-3-4" class="nav-link" data-scroll-target="#リスト-5-3-4">リスト 5-3-(4)</a></li>
  <li><a href="#リスト-5-3-5" id="toc-リスト-5-3-5" class="nav-link" data-scroll-target="#リスト-5-3-5">リスト 5-3-(5)</a></li>
  <li><a href="#リスト-5-3-6" id="toc-リスト-5-3-6" class="nav-link" data-scroll-target="#リスト-5-3-6">リスト 5-3-(6)</a></li>
  <li><a href="#リスト-5-3-7" id="toc-リスト-5-3-7" class="nav-link" data-scroll-target="#リスト-5-3-7">リスト 5-3-(7)</a></li>
  <li><a href="#リスト-5-3-8" id="toc-リスト-5-3-8" class="nav-link" data-scroll-target="#リスト-5-3-8">リスト 5-3-(8)</a></li>
  <li><a href="#リスト-5-3-9" id="toc-リスト-5-3-9" class="nav-link" data-scroll-target="#リスト-5-3-9">リスト 5-3-(9)</a></li>
  <li><a href="#リスト-5-3-10" id="toc-リスト-5-3-10" class="nav-link" data-scroll-target="#リスト-5-3-10">リスト 5-3-(10)</a></li>
  <li><a href="#リスト-5-3-11" id="toc-リスト-5-3-11" class="nav-link" data-scroll-target="#リスト-5-3-11">リスト 5-3-(11)</a></li>
  <li><a href="#リスト-5-3-12" id="toc-リスト-5-3-12" class="nav-link" data-scroll-target="#リスト-5-3-12">リスト 5-3-(12)</a></li>
  <li><a href="#リスト-5-3-13" id="toc-リスト-5-3-13" class="nav-link" data-scroll-target="#リスト-5-3-13">リスト 5-3-(13)</a></li>
  <li><a href="#リスト-5-3-14" id="toc-リスト-5-3-14" class="nav-link" data-scroll-target="#リスト-5-3-14">リスト 5-3-(14)</a></li>
  <li><a href="#リスト-5-3-15" id="toc-リスト-5-3-15" class="nav-link" data-scroll-target="#リスト-5-3-15">リスト 5-3-(15)</a></li>
  <li><a href="#リスト-5-3-16" id="toc-リスト-5-3-16" class="nav-link" data-scroll-target="#リスト-5-3-16">リスト 5-3-(16)</a></li>
  </ul></li>
  <li><a href="#第4節" id="toc-第4節" class="nav-link" data-scroll-target="#第4節">第4節</a>
  <ul class="collapse">
  <li><a href="#リセット-2" id="toc-リセット-2" class="nav-link" data-scroll-target="#リセット-2">リセット</a></li>
  <li><a href="#リスト-5-4-1" id="toc-リスト-5-4-1" class="nav-link" data-scroll-target="#リスト-5-4-1">リスト 5-4-(1)</a></li>
  <li><a href="#リスト-5-4-2" id="toc-リスト-5-4-2" class="nav-link" data-scroll-target="#リスト-5-4-2">リスト 5-4-(2)</a></li>
  <li><a href="#リスト-5-4-3" id="toc-リスト-5-4-3" class="nav-link" data-scroll-target="#リスト-5-4-3">リスト 5-4-(3)</a></li>
  <li><a href="#リスト-5-4-4" id="toc-リスト-5-4-4" class="nav-link" data-scroll-target="#リスト-5-4-4">リスト 5-4-(4)</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">教師あり学習 : 回帰</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<code>{ggplot2}</code>のフォントについて
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>theme_set()</code>で指定しても文字が正しく出力されないため，無理やり対処する．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>myf <span class="ot">&lt;-</span> <span class="st">'HiraginoSans-W3'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<section id="準備" class="level2">
<h2 class="anchored" data-anchor-id="準備">準備</h2>
<p>まず，パッケージを読み込む．また，<code>data</code>というディレクトリを作成しておく．</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">dir.create</span>(<span class="st">'data'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="内容" class="level2">
<h2 class="anchored" data-anchor-id="内容">内容</h2>
<section id="第1節" class="level3">
<h3 class="anchored" data-anchor-id="第1節">第1節</h3>
<section id="リスト-5-1-1" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-1">リスト 5-1-(1)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Python</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># R</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>Numpy</code>, <code>Matplotlib</code>に対応するパッケージとして，<code>{tidyverse}</code>を用いる．グラフ描画には<code>{ggplot2}</code>を用いるが，これは<code>{tidyverse}</code>を読み込めば，連動して読み込まれる．</p>
<p><strong>データ生成 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Python</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>np.random.seed(seed<span class="op">=</span><span class="dv">1</span>)          <span class="co"># 乱数を固定する</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>X_min, X_max <span class="op">=</span> <span class="dv">4</span>, <span class="dv">30</span>            <span class="co"># X の下限と上限（表示用）</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>N <span class="op">=</span> <span class="dv">16</span>                          <span class="co"># データの個数</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>X <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">25</span> <span class="op">*</span> np.random.rand(N)  <span class="co"># X の生成</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>prm <span class="op">=</span> [<span class="dv">170</span>, <span class="dv">108</span>, <span class="fl">0.2</span>]           <span class="co"># データ生成のパラメータ</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>T <span class="op">=</span> prm[<span class="dv">0</span>] <span class="op">-</span> prm[<span class="dv">1</span>] <span class="op">*</span> np.exp(<span class="op">-</span>prm[<span class="dv">2</span>] <span class="op">*</span> X) <span class="op">\</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> np.random.randn(N)    <span class="co"># (A) 目標データの生成</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>np.savez(                       <span class="co"># (B) データの保存</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="st">"ch5_data.npz"</span>,</span>
<span id="cb5-11"><a href="#cb5-11"></a>    X<span class="op">=</span>X, T<span class="op">=</span>T, X_min<span class="op">=</span>X_min, X_max<span class="op">=</span>X_max, N<span class="op">=</span>N,</span>
<span id="cb5-12"><a href="#cb5-12"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># R</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)                                            <span class="co"># 乱数を固定する</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>X_min <span class="ot">&lt;-</span> <span class="dv">4</span>; X_max <span class="ot">&lt;-</span> <span class="dv">30</span>                                <span class="co"># X の下限と上限</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>N <span class="ot">&lt;-</span> <span class="dv">16</span>                                                <span class="co"># データの個数</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>X <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">25</span> <span class="sc">*</span> <span class="fu">runif</span>(N)                                 <span class="co"># X の生成</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>prm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">108</span>, <span class="fl">0.2</span>)                                <span class="co"># データ生成のパラメタ</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>t <span class="ot">&lt;-</span> prm[<span class="dv">1</span>] <span class="sc">-</span> prm[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>prm[<span class="dv">3</span>] <span class="sc">*</span> X) <span class="sc">+</span> <span class="dv">4</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N) <span class="co"># (A) 目標データの生成</span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="fu">save</span>(                                                  <span class="co"># (B) データの保存</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="at">list =</span> <span class="fu">c</span>(<span class="st">'X'</span>, <span class="st">'t'</span>, <span class="st">'X_min'</span>, <span class="st">'X_max'</span>, <span class="st">'N'</span>),</span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="at">file =</span> <span class="st">'data/ch5_data.Rdata'</span></span>
<span id="cb6-11"><a href="#cb6-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>np.random.seed()</code>では乱数の種を指定している．Rにおける<code>set.seed()</code>と同じである．</p>
<p><code>np.random.rand()</code>は<span class="math inline">\([0, 1]\)</span>の一様分布から乱数を発生させる関数である．Rでは<code>runif()</code>を用いると同じ操作が可能だ．</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
「予約語」と「インデックスの違い」
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>予約語</strong></p>
<p>Rにおいて，<code>T</code>は<code>TRUE</code>の予約語であるため，目標データを格納するオブジェクトは<code>t</code>としている．</p>
<p><strong>インデックスの違い</strong></p>
<p>Pythonでは，インデックスは0から始まる．例えば，<span class="math inline">\(x = [1, 2]\)</span>というベクトルがあり，このベクトルから1つ目の要素を取り出したい場合は<code>x[0]</code>としなければならない．Rでは<code>x[1]</code>であるため，注意されたい．</p>
</div>
</div>
</section>
<section id="リスト-5-1-2" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-2">リスト 5-1-(2)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Python</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="bu">print</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># R</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">print</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 11.637717 14.303097 19.321334 27.705195 10.042048 27.459742 28.616882
 [8] 21.519945 20.727851  6.544657 10.149364  9.413919 22.175571 14.602593
[15] 24.246035 17.442481</code></pre>
</div>
</div>
</section>
<section id="リスト-5-1-3" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-3">リスト 5-1-(3)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Python</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="bu">print</span>(np.<span class="bu">round</span>(X, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># R</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">print</span>(<span class="fu">round</span>(X, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 11.64 14.30 19.32 27.71 10.04 27.46 28.62 21.52 20.73  6.54 10.15  9.41
[13] 22.18 14.60 24.25 17.44</code></pre>
</div>
</div>
</section>
<section id="リスト-5-1-4" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-4">リスト 5-1-(4)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Python</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="bu">print</span>(np.<span class="bu">round</span>(T, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># R</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">print</span>(<span class="fu">round</span>(t, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 161.77 162.60 173.78 171.14 153.02 160.70 174.15 168.36 168.23 144.60
[11] 159.10 155.94 172.40 167.31 169.45 158.74</code></pre>
</div>
</div>
</section>
<section id="リスト-5-1-5" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-5">リスト 5-1-(5)</h4>
<p><strong>データ表示 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Python</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb16-3"><a href="#cb16-3"></a>plt.plot(</span>
<span id="cb16-4"><a href="#cb16-4"></a>    X,                        <span class="co"># 入力データ</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>    T,                        <span class="co"># 目標データ</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="st">"cornflowerblue"</span>,         <span class="co"># マーカーを水色にする</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>    marker<span class="op">=</span><span class="st">"o"</span>,               <span class="co"># マーカーの形をoにする</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>    linestyle<span class="op">=</span><span class="st">"None"</span>,         <span class="co"># マーカーを線で結ばない</span></span>
<span id="cb16-9"><a href="#cb16-9"></a>    markeredgecolor<span class="op">=</span><span class="st">"black"</span>,  <span class="co"># マーカーの輪郭を黒にする</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>)</span>
<span id="cb16-11"><a href="#cb16-11"></a>plt.xlim(X_min, X_max)        <span class="co"># x軸の範囲を指定</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>plt.grid()                    <span class="co"># グリッドを表示する</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># R</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb17-4"><a href="#cb17-4"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb17-5"><a href="#cb17-5"></a>             <span class="at">color =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">140</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">25</span> <span class="sc">/</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'年齢x'</span>, <span class="at">y =</span> <span class="st">'身長t'</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> myf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-1-6" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-6">リスト 5-1-(6)</h4>
<p><strong>平均二乗誤差(MSE)関数 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Python</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">def</span> mse_line(x, t, w):</span>
<span id="cb18-3"><a href="#cb18-3"></a>    y <span class="op">=</span> w[<span class="dv">0</span>] <span class="op">*</span> x <span class="op">+</span> w[<span class="dv">1</span>]          <span class="co"># 式5-4、yを求める</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>    mse <span class="op">=</span> np.mean((y <span class="op">-</span> t) <span class="op">**</span> <span class="dv">2</span>)  <span class="co"># 式5-3、平均二乗誤差</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="cf">return</span> mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># R</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>mse_line <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, w) {</span>
<span id="cb19-3"><a href="#cb19-3"></a>  y <span class="ot">&lt;-</span> w[<span class="dv">1</span>] <span class="sc">*</span> x <span class="sc">+</span> w[<span class="dv">2</span>]     <span class="co"># 式5-4 yを求める</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((y <span class="sc">-</span> t) <span class="sc">^</span> <span class="dv">2</span>) <span class="co"># 式5-3 平均二乗誤差</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="fu">return</span>(mse)</span>
<span id="cb19-6"><a href="#cb19-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>各w0、w1で平均二乗誤差(MSE)を計算 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Python</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>w0_n, w1_n <span class="op">=</span> <span class="dv">100</span>, <span class="dv">100</span>                   <span class="co"># グラフ表示の解像度</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>w0_min, w0_max <span class="op">=</span> <span class="op">-</span><span class="dv">25</span>, <span class="dv">25</span>                <span class="co"># w0の計算範囲</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>w1_min, w1_max <span class="op">=</span> <span class="dv">120</span>, <span class="dv">170</span>               <span class="co"># w1の計算範囲</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>w0 <span class="op">=</span> np.linspace(w0_min, w0_max, w0_n)  <span class="co"># w0を準備</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>w1 <span class="op">=</span> np.linspace(w1_min, w1_max, w1_n)  <span class="co"># w1を準備</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>J <span class="op">=</span> np.zeros((w1_n, w0_n))              <span class="co"># MSEを入れる配列Jを準備</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="co"># グリッド状の点(w0, w1)に対してJを計算</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="cf">for</span> i0 <span class="kw">in</span> <span class="bu">range</span>(w0_n):</span>
<span id="cb20-10"><a href="#cb20-10"></a>    <span class="cf">for</span> i1 <span class="kw">in</span> <span class="bu">range</span>(w1_n):</span>
<span id="cb20-11"><a href="#cb20-11"></a>      w <span class="op">=</span> np.array([w0[i0], w1[i1]])</span>
<span id="cb20-12"><a href="#cb20-12"></a>      J[i1, i0] <span class="op">=</span> mse_line(X, T, w)</span>
<span id="cb20-13"><a href="#cb20-13"></a>ww0, ww1 <span class="op">=</span> np.meshgrid(w0, w1)          <span class="co"># グリッド座標の作成</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># R</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>w0_n <span class="ot">&lt;-</span> <span class="dv">100</span>; w1_n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb21-3"><a href="#cb21-3"></a>w0_min <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">25</span>; w0_max <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>w1_min <span class="ot">&lt;-</span> <span class="dv">120</span>; w1_max <span class="ot">&lt;-</span> <span class="dv">170</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>w0 <span class="ot">&lt;-</span> <span class="fu">seq</span>(w0_min, w0_max, <span class="at">length.out =</span> w0_n)</span>
<span id="cb21-6"><a href="#cb21-6"></a>w1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(w1_min, w1_max, <span class="at">length.out =</span> w1_n)</span>
<span id="cb21-7"><a href="#cb21-7"></a>J <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(w1_n, w0_n))</span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="cf">for</span> (i0 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>w0_n) {</span>
<span id="cb21-9"><a href="#cb21-9"></a>  <span class="cf">for</span> (i1 <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>w1_n) {</span>
<span id="cb21-10"><a href="#cb21-10"></a>    w <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(w0[i0], w1[i1]), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb21-11"><a href="#cb21-11"></a>    J[i0, i1] <span class="ot">&lt;-</span> <span class="fu">mse_line</span>(X, t, w)</span>
<span id="cb21-12"><a href="#cb21-12"></a>  }</span>
<span id="cb21-13"><a href="#cb21-13"></a>}</span>
<span id="cb21-14"><a href="#cb21-14"></a>grid_w0w1 <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(w0, w1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<ol type="1">
<li>サーフェス表示</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Python</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="fl">9.5</span>, <span class="dv">4</span>))</span>
<span id="cb22-3"><a href="#cb22-3"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb22-4"><a href="#cb22-4"></a>ax <span class="op">=</span> plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a>ax.plot_surface(</span>
<span id="cb22-6"><a href="#cb22-6"></a>    ww0, ww1, J,</span>
<span id="cb22-7"><a href="#cb22-7"></a>    rstride<span class="op">=</span><span class="dv">10</span>, cstride<span class="op">=</span><span class="dv">10</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"blue"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb22-8"><a href="#cb22-8"></a>)</span>
<span id="cb22-9"><a href="#cb22-9"></a>ax.set_xticks([<span class="op">-</span><span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">20</span>])     <span class="co"># x軸の目盛り指定</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>ax.set_yticks([<span class="dv">120</span>, <span class="dv">140</span>, <span class="dv">160</span>])  <span class="co"># y軸の目盛り指定</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>ax.view_init(<span class="dv">20</span>, <span class="op">-</span><span class="dv">60</span>)           <span class="co"># グラフの向きの指定</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># R</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">persp</span>(w0, w1, J, <span class="at">theta =</span> <span class="dv">40</span>, <span class="at">phi =</span> <span class="dv">20</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>      <span class="at">xlab =</span> <span class="fu">expression</span>(w[<span class="dv">0</span>]), <span class="at">ylab =</span> <span class="fu">expression</span>(w[<span class="dv">1</span>]), <span class="at">zlab =</span> <span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="2" type="1">
<li>等高線表示</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Python</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb24-3"><a href="#cb24-3"></a>cont <span class="op">=</span> plt.contour(</span>
<span id="cb24-4"><a href="#cb24-4"></a>    ww0, ww1, J, colors<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb24-5"><a href="#cb24-5"></a>    levels<span class="op">=</span>[<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>],  <span class="co"># 描く等高線の値を指定</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>)</span>
<span id="cb24-7"><a href="#cb24-7"></a>cont.clabel(fmt<span class="op">=</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb24-8"><a href="#cb24-8"></a>plt.grid()</span>
<span id="cb24-9"><a href="#cb24-9"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># R</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>df <span class="ot">&lt;-</span> grid_w0w1 <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">mutate</span>(<span class="at">J =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="fu">n</span>()))</span>
<span id="cb25-4"><a href="#cb25-4"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>w0_n) {</span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>w1_n) {</span>
<span id="cb25-7"><a href="#cb25-7"></a>    df<span class="sc">$</span>J[n] <span class="ot">&lt;-</span> J[i, j]</span>
<span id="cb25-8"><a href="#cb25-8"></a>    n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>  }</span>
<span id="cb25-10"><a href="#cb25-10"></a>}</span>
<span id="cb25-11"><a href="#cb25-11"></a>df <span class="sc">|&gt;</span></span>
<span id="cb25-12"><a href="#cb25-12"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> w0, <span class="at">y =</span> w1, <span class="at">z =</span> J),</span>
<span id="cb25-14"><a href="#cb25-14"></a>               <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">25</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">120</span>, <span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">50</span> <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(w[<span class="dv">0</span>]), <span class="at">y =</span> <span class="fu">expression</span>(w[<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-1-7" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-7">リスト 5-1-(7)</h4>
<p><strong>平均二乗誤差(MSE)の勾配 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Python</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="kw">def</span> dmse_line(x, t, w):</span>
<span id="cb26-3"><a href="#cb26-3"></a>    y <span class="op">=</span> w[<span class="dv">0</span>] <span class="op">*</span> x <span class="op">+</span> w[<span class="dv">1</span>]</span>
<span id="cb26-4"><a href="#cb26-4"></a>    d_w0 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.mean((y <span class="op">-</span> t) <span class="op">*</span> x)  <span class="co"># 式5-9</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>    d_w1 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.mean(y <span class="op">-</span> t)        <span class="co"># 式5-10</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="cf">return</span> d_w0, d_w1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># R</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>dmse_line <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, w) {</span>
<span id="cb27-3"><a href="#cb27-3"></a>  y <span class="ot">&lt;-</span> w[<span class="dv">1</span>] <span class="sc">*</span> x <span class="sc">+</span> w[<span class="dv">2</span>]</span>
<span id="cb27-4"><a href="#cb27-4"></a>  d_w0 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>((y <span class="sc">-</span> t) <span class="sc">*</span> x) <span class="co"># 式5-9</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  d_w1 <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(y <span class="sc">-</span> t)       <span class="co"># 式5-10</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">return</span>(<span class="fu">c</span>(d_w0, d_w1))</span>
<span id="cb27-7"><a href="#cb27-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-1-8" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-8">リスト 5-1-(8)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Python</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>w <span class="op">=</span> np.array([<span class="dv">10</span>, <span class="dv">165</span>])</span>
<span id="cb28-3"><a href="#cb28-3"></a>d_w <span class="op">=</span> dmse_line(X, T, w)</span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="bu">print</span>(np.<span class="bu">round</span>(d_w, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># R</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>w <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">165</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb29-3"><a href="#cb29-3"></a>d_w <span class="ot">&lt;-</span> <span class="fu">dmse_line</span>(X, t, w)</span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="fu">print</span>(<span class="fu">round</span>(d_w, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7305.29  359.73</code></pre>
</div>
</div>
</section>
<section id="リスト-5-1-9" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-9">リスト 5-1-(9)</h4>
<p><strong>勾配法 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Python</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="kw">def</span> fit_line_num(x, t, w_init):</span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="co"># パラメータ</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  alpha <span class="op">=</span> <span class="fl">0.001</span>     <span class="co"># 学習率</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>  tau_max <span class="op">=</span> <span class="dv">100000</span>  <span class="co"># 繰り返しの最大数</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>  eps <span class="op">=</span> <span class="fl">0.1</span>         <span class="co"># 繰り返し計算を終了するための閾値</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="co"># 勾配法</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>  w <span class="op">=</span> np.zeros((tau_max <span class="op">+</span> <span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># 変化するwの履歴を入れる配列</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>  w[<span class="dv">0</span>, :] <span class="op">=</span> w_init                <span class="co"># wの初期値をセット</span></span>
<span id="cb31-10"><a href="#cb31-10"></a>  <span class="cf">for</span> tau <span class="kw">in</span> <span class="bu">range</span>(tau_max):</span>
<span id="cb31-11"><a href="#cb31-11"></a>    dmse <span class="op">=</span> dmse_line(x, t, w[tau, :])</span>
<span id="cb31-12"><a href="#cb31-12"></a>    w[tau <span class="op">+</span> <span class="dv">1</span>, <span class="dv">0</span>] <span class="op">=</span> w[tau, <span class="dv">0</span>] <span class="op">-</span> alpha <span class="op">*</span> dmse[<span class="dv">0</span>]  <span class="co"># 式5-6</span></span>
<span id="cb31-13"><a href="#cb31-13"></a>    w[tau <span class="op">+</span> <span class="dv">1</span>, <span class="dv">1</span>] <span class="op">=</span> w[tau, <span class="dv">1</span>] <span class="op">-</span> alpha <span class="op">*</span> dmse[<span class="dv">1</span>]  <span class="co"># 式5-7</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>    <span class="cf">if</span> <span class="bu">max</span>(np.absolute(dmse)) <span class="op">&lt;</span> eps:  <span class="co"># 終了判定</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>       <span class="cf">break</span>  <span class="co"># tau のループから抜ける</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>  w_final <span class="op">=</span> w[tau <span class="op">+</span> <span class="dv">1</span>, :]   <span class="co"># 最終的に得られたw</span></span>
<span id="cb31-17"><a href="#cb31-17"></a>  w_hist <span class="op">=</span> w[: tau <span class="op">+</span> <span class="dv">2</span>, :]  <span class="co"># wの履歴で更新した分を抜き出す</span></span>
<span id="cb31-18"><a href="#cb31-18"></a>  <span class="cf">return</span> w_final, dmse, w_hist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># R</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>fit_line_num <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, w_init) {</span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="co"># パラメタ</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  alpha <span class="ot">&lt;-</span> <span class="fl">0.001</span>    <span class="co"># 学習率</span></span>
<span id="cb32-5"><a href="#cb32-5"></a>  tau_max <span class="ot">&lt;-</span> <span class="dv">100000</span> <span class="co"># 繰り返しの最大数</span></span>
<span id="cb32-6"><a href="#cb32-6"></a>  eps <span class="ot">&lt;-</span> <span class="fl">0.1</span>        <span class="co"># 繰り返し計算を終了するための閾値</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>  <span class="co"># 勾配法</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>  w <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(tau_max <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># 変化するwの履歴を入れる配列</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>  w[<span class="dv">1</span>,] <span class="ot">&lt;-</span> w_init                        <span class="co"># wの初期値をセット</span></span>
<span id="cb32-10"><a href="#cb32-10"></a>  <span class="cf">for</span> (tau <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tau_max) {</span>
<span id="cb32-11"><a href="#cb32-11"></a>    dmse <span class="ot">&lt;-</span> <span class="fu">dmse_line</span>(x, t, w[tau,])</span>
<span id="cb32-12"><a href="#cb32-12"></a>    w[tau <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> w[tau, <span class="dv">1</span>] <span class="sc">-</span> alpha <span class="sc">*</span> dmse[<span class="dv">1</span>] <span class="co"># 式5-6</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>    w[tau <span class="sc">+</span> <span class="dv">1</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> w[tau, <span class="dv">2</span>] <span class="sc">-</span> alpha <span class="sc">*</span> dmse[<span class="dv">2</span>] <span class="co"># 式5-7</span></span>
<span id="cb32-14"><a href="#cb32-14"></a>    <span class="cf">if</span> (<span class="fu">max</span>(<span class="fu">abs</span>(dmse)) <span class="sc">&lt;</span> eps) <span class="cf">break</span>              <span class="co"># 終了判定, tauのループから抜ける</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>  }</span>
<span id="cb32-16"><a href="#cb32-16"></a>  w_final <span class="ot">&lt;-</span> w[tau <span class="sc">+</span> <span class="dv">1</span>,]    <span class="co"># 最終的に得られたw</span></span>
<span id="cb32-17"><a href="#cb32-17"></a>  w_hist <span class="ot">&lt;-</span> w[<span class="dv">1</span><span class="sc">:</span>(tau <span class="sc">+</span> <span class="dv">2</span>),] <span class="co"># wの履歴で更新した分を抜き出す</span></span>
<span id="cb32-18"><a href="#cb32-18"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">w_final =</span> w_final, <span class="at">dmse =</span> dmse, <span class="at">w_hist =</span> w_hist)</span>
<span id="cb32-19"><a href="#cb32-19"></a>  <span class="fu">return</span>(res)</span>
<span id="cb32-20"><a href="#cb32-20"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Python</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># 勾配法でwを計算</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>w_init <span class="op">=</span> np.array([<span class="fl">10.0</span>, <span class="fl">165.0</span>])               <span class="co"># wの初期値</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>w, dmse, w_history <span class="op">=</span> fit_line_num(X, T, w_init)  <span class="co"># wを計算</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>mse <span class="op">=</span> mse_line(X, T, w)                        <span class="co"># MSEを計算</span></span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="co"># 結果表示</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="bu">print</span>(<span class="ss">f"繰り返し回数 </span><span class="sc">{</span>w_history<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a><span class="bu">print</span>(<span class="ss">f"w0 = </span><span class="sc">{</span>w[<span class="dv">0</span>]<span class="sc">:.6f}</span><span class="ss">, w1 = </span><span class="sc">{</span>w[<span class="dv">1</span>]<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb33-9"><a href="#cb33-9"></a><span class="bu">print</span>(<span class="ss">f"dMSE = [</span><span class="sc">{</span>dmse[<span class="dv">0</span>]<span class="sc">:.6f}</span><span class="ss">, </span><span class="sc">{</span>dmse[<span class="dv">1</span>]<span class="sc">:.6f}</span><span class="ss">]"</span>)</span>
<span id="cb33-10"><a href="#cb33-10"></a><span class="bu">print</span>(<span class="ss">f"MSE = </span><span class="sc">{</span>mse<span class="sc">:.6f}</span><span class="ss">"</span>)</span>
<span id="cb33-11"><a href="#cb33-11"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mse)<span class="sc">:.6f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># R</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co"># 勾配法でwを計算</span></span>
<span id="cb34-3"><a href="#cb34-3"></a>w_init <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">165</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))                  <span class="co"># wの初期値</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>res <span class="ot">&lt;-</span> <span class="fu">fit_line_num</span>(X, t, w_init)                           <span class="co"># wを計算</span></span>
<span id="cb34-5"><a href="#cb34-5"></a>w <span class="ot">&lt;-</span> res<span class="sc">$</span>w_final; dmse <span class="ot">&lt;-</span> res<span class="sc">$</span>dmse; w_history <span class="ot">&lt;-</span> res<span class="sc">$</span>w_hist</span>
<span id="cb34-6"><a href="#cb34-6"></a>mse <span class="ot">&lt;-</span> <span class="fu">mse_line</span>(X, t, w)                                    <span class="co"># MSEを計算</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="fu">cat</span>(<span class="st">'繰り返し数'</span>, <span class="fu">nrow</span>(w_history))</span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="fu">cat</span>(<span class="st">'w0 ='</span>, <span class="fu">round</span>(w[<span class="dv">1</span>],<span class="dv">6</span>), <span class="st">'w1 ='</span>, <span class="fu">round</span>(w[<span class="dv">2</span>], <span class="dv">6</span>))</span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="fu">cat</span>(<span class="st">'dMSE ='</span>, <span class="st">'['</span>, dmse[<span class="dv">1</span>], <span class="st">','</span>, dmse[<span class="dv">2</span>], <span class="st">']'</span>)</span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="fu">cat</span>(<span class="st">'MSE ='</span>, <span class="fu">round</span>(mse, <span class="dv">6</span>))</span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">sqrt</span>(mse) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">6</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>繰り返し数 14410</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>w0 = 0.867801 w1 = 148.3728</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>dMSE = [ -0.004864737 , 0.09999624 ]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE = 26.47251</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 5.145144 cm</code></pre>
</div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Python</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>plt.figure(ﬁgsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="co"># 等高線表示</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>cont <span class="op">=</span> plt.contour(</span>
<span id="cb40-5"><a href="#cb40-5"></a>  ww0, ww1, J,     <span class="co"># リスト5-1-(6)で作成済</span></span>
<span id="cb40-6"><a href="#cb40-6"></a>  colors<span class="op">=</span><span class="st">"black"</span>, levels<span class="op">=</span>[<span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>],</span>
<span id="cb40-7"><a href="#cb40-7"></a>)</span>
<span id="cb40-8"><a href="#cb40-8"></a>cont.clabel(fmt<span class="op">=</span><span class="st">"%1.0f"</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb40-9"><a href="#cb40-9"></a><span class="co"># 等高線の上に、過去のすべてのwをプロット</span></span>
<span id="cb40-10"><a href="#cb40-10"></a>plt.plot(  </span>
<span id="cb40-11"><a href="#cb40-11"></a>  w_history[:, <span class="dv">0</span>], w_history[:, <span class="dv">1</span>], <span class="st">"gray"</span>,</span>
<span id="cb40-12"><a href="#cb40-12"></a>  marker<span class="op">=</span><span class="st">"."</span>,                        <span class="co"># マーカーの形</span></span>
<span id="cb40-13"><a href="#cb40-13"></a>  markersize<span class="op">=</span><span class="dv">10</span>,                     <span class="co"># マーカーの大きさ</span></span>
<span id="cb40-14"><a href="#cb40-14"></a>  markeredgecolor<span class="op">=</span><span class="st">"cornflowerblue"</span>,  <span class="co"># マーカーの輪郭の色</span></span>
<span id="cb40-15"><a href="#cb40-15"></a>)</span>
<span id="cb40-16"><a href="#cb40-16"></a>plt.grid()</span>
<span id="cb40-17"><a href="#cb40-17"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># R</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">geom_contour</span>(<span class="at">data    =</span> df,</span>
<span id="cb41-4"><a href="#cb41-4"></a>               <span class="at">mapping =</span> <span class="fu">aes</span>(w0, w1, <span class="at">z =</span> J),</span>
<span id="cb41-5"><a href="#cb41-5"></a>               <span class="at">color =</span> <span class="st">'black'</span>) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> w_history[,<span class="dv">1</span>], <span class="at">y_plt =</span> w_history[,<span class="dv">2</span>]),</span>
<span id="cb41-7"><a href="#cb41-7"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb41-8"><a href="#cb41-8"></a>             <span class="at">color =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb41-9"><a href="#cb41-9"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">25</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">120</span>, <span class="dv">170</span>) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">50</span> <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb41-11"><a href="#cb41-11"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(w[<span class="dv">0</span>]), <span class="at">y =</span> <span class="fu">expression</span>(w[<span class="dv">1</span>])) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-1-10" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-10">リスト 5-1-(10)</h4>
<p><strong>線の表示 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Python</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="kw">def</span> show_line(w):</span>
<span id="cb42-3"><a href="#cb42-3"></a>  x <span class="op">=</span> np.linspace(X_min, X_max, <span class="dv">100</span>)</span>
<span id="cb42-4"><a href="#cb42-4"></a>  y <span class="op">=</span> w[<span class="dv">0</span>] <span class="op">*</span> x <span class="op">+</span> w[<span class="dv">1</span>]</span>
<span id="cb42-5"><a href="#cb42-5"></a>  plt.plot(x, y, <span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="co"># R</span></span>
<span id="cb43-2"><a href="#cb43-2"></a>show_line <span class="ot">&lt;-</span> <span class="cf">function</span>(w) {</span>
<span id="cb43-3"><a href="#cb43-3"></a>  x <span class="ot">=</span> <span class="fu">seq</span>(X_min, X_max, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb43-4"><a href="#cb43-4"></a>  y <span class="ot">&lt;-</span> w[<span class="dv">1</span>] <span class="sc">*</span> x <span class="sc">+</span> w[<span class="dv">2</span>]</span>
<span id="cb43-5"><a href="#cb43-5"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>    <span class="fu">geom_line</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> x, <span class="at">y_plt =</span> y),</span>
<span id="cb43-7"><a href="#cb43-7"></a>              <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb43-8"><a href="#cb43-8"></a>              <span class="at">color   =</span> <span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb43-10"><a href="#cb43-10"></a>  <span class="fu">return</span>(p)</span>
<span id="cb43-11"><a href="#cb43-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># Python</span></span>
<span id="cb44-2"><a href="#cb44-2"></a><span class="co"># グラフ描画</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb44-4"><a href="#cb44-4"></a>show_line(w)  <span class="co"># w はリスト5-1-(9)で計算済</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>plt.plot(</span>
<span id="cb44-6"><a href="#cb44-6"></a>  X, T, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb44-7"><a href="#cb44-7"></a>  marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb44-8"><a href="#cb44-8"></a>)</span>
<span id="cb44-9"><a href="#cb44-9"></a>plt.xlim(X_min, X_max)</span>
<span id="cb44-10"><a href="#cb44-10"></a>plt.grid()</span>
<span id="cb44-11"><a href="#cb44-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># R</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="fu">show_line</span>(w) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb45-4"><a href="#cb45-4"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb45-5"><a href="#cb45-5"></a>             <span class="at">color   =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">140</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">25</span> <span class="sc">/</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'年齢x'</span>, <span class="at">y =</span> <span class="st">'身長t'</span>) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> myf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-1-11" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-1-11">リスト 5-1-(11)</h4>
<p><strong>解析解 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Python</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="kw">def</span> fit_line(x, t):</span>
<span id="cb46-3"><a href="#cb46-3"></a>  mx <span class="op">=</span> np.mean(x)        <span class="co"># &lt;x&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>  mt <span class="op">=</span> np.mean(t)        <span class="co"># &lt;t&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>  mtx <span class="op">=</span> np.mean(t <span class="op">*</span> x)   <span class="co"># &lt;tx&gt;</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  mxx <span class="op">=</span> np.mean(x <span class="op">*</span> x)   <span class="co"># &lt;x^2&gt;</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>  w0 <span class="op">=</span> (mtx <span class="op">-</span> mt <span class="op">*</span> mx) <span class="op">/</span> (mxx <span class="op">-</span> mx <span class="op">**</span> <span class="dv">2</span>)  <span class="co"># 式5-20</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>  w1 <span class="op">=</span> mt <span class="op">-</span> w0 <span class="op">*</span> mx                       <span class="co"># 式5-21</span></span>
<span id="cb46-9"><a href="#cb46-9"></a>  w <span class="op">=</span> np.array([w0, w1])</span>
<span id="cb46-10"><a href="#cb46-10"></a>  <span class="cf">return</span> w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># R</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>fit_line <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t) {</span>
<span id="cb47-3"><a href="#cb47-3"></a>  mx <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)      <span class="co"># &lt;x&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>  mt <span class="ot">&lt;-</span> <span class="fu">mean</span>(t)      <span class="co"># &lt;t&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5"></a>  mtx <span class="ot">&lt;-</span> <span class="fu">mean</span>(t <span class="sc">*</span> x) <span class="co"># &lt;tx&gt;</span></span>
<span id="cb47-6"><a href="#cb47-6"></a>  mxx <span class="ot">&lt;-</span> <span class="fu">mean</span>(x <span class="sc">*</span> x) <span class="co"># &lt;x^2&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>  w0 <span class="ot">&lt;-</span> (mtx <span class="sc">-</span> mt <span class="sc">*</span> mx) <span class="sc">/</span> (mxx <span class="sc">-</span> mx <span class="sc">^</span> <span class="dv">2</span>) <span class="co"># 式5-20</span></span>
<span id="cb47-8"><a href="#cb47-8"></a>  w1 <span class="ot">&lt;-</span> mt <span class="sc">-</span> w0 <span class="sc">*</span> mx                     <span class="co"># 式5-21</span></span>
<span id="cb47-9"><a href="#cb47-9"></a>  w <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(w0, w1), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb47-10"><a href="#cb47-10"></a>  <span class="fu">return</span>(w)</span>
<span id="cb47-11"><a href="#cb47-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Python</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>w <span class="op">=</span> fit_line(X, T)       <span class="co"># 解析解でwを計算</span></span>
<span id="cb48-3"><a href="#cb48-3"></a>mse <span class="op">=</span> mse_line(X, T, w)  <span class="co"># MSEを計算</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co"># 結果表示</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="bu">print</span>(<span class="ss">f"w0 = </span><span class="sc">{</span>w[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, w1 = </span><span class="sc">{</span>w[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="bu">print</span>(<span class="ss">f"MSE = </span><span class="sc">{</span>mse<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mse)<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># R</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>w <span class="ot">&lt;-</span> <span class="fu">fit_line</span>(X, t)      <span class="co"># 解析解でwを計算</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>mse <span class="ot">&lt;-</span> <span class="fu">mse_line</span>(X, t, w) <span class="co"># MSEを計算</span></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="co"># 結果表示</span></span>
<span id="cb49-5"><a href="#cb49-5"></a><span class="fu">cat</span>(<span class="st">'w0 ='</span>, <span class="fu">round</span>(w[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">'w1 ='</span>, <span class="fu">round</span>(w[<span class="dv">2</span>], <span class="dv">2</span>))</span>
<span id="cb49-6"><a href="#cb49-6"></a><span class="fu">cat</span>(<span class="st">'MSE ='</span>, <span class="fu">round</span>(mse, <span class="dv">2</span>))</span>
<span id="cb49-7"><a href="#cb49-7"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">sqrt</span>(mse) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>w0 = 0.89 w1 = 147.99</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>MSE = 26.45</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 5.14 cm</code></pre>
</div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># Python</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb53-3"><a href="#cb53-3"></a>show_line(w)</span>
<span id="cb53-4"><a href="#cb53-4"></a>plt.plot(</span>
<span id="cb53-5"><a href="#cb53-5"></a>  X, T, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb53-6"><a href="#cb53-6"></a>  marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb53-7"><a href="#cb53-7"></a>)</span>
<span id="cb53-8"><a href="#cb53-8"></a>plt.xlim(X_min, X_max)</span>
<span id="cb53-9"><a href="#cb53-9"></a>plt.grid()</span>
<span id="cb53-10"><a href="#cb53-10"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># R</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="fu">show_line</span>(w) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>  <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb54-4"><a href="#cb54-4"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb54-5"><a href="#cb54-5"></a>             <span class="at">color   =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>  <span class="fu">xlim</span>(<span class="dv">5</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">140</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">25</span> <span class="sc">/</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'年齢x'</span>, <span class="at">y =</span> <span class="st">'身長t'</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> myf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="第2節" class="level3">
<h3 class="anchored" data-anchor-id="第2節">第2節</h3>
<section id="リセット" class="level4">
<h4 class="anchored" data-anchor-id="リセット">リセット</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># Python</span></span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="op">%</span>reset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="co"># R</span></span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="st">'myf'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注意
</div>
</div>
<div class="callout-body-container callout-body">
<p>フォントを指定している<code>myf</code>オブジェクトは消さない．</p>
</div>
</div>
</section>
<section id="リスト-5-2-1" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-2-1">リスト 5-2-(1)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># Python</span></span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># R</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>データのロード ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Python</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>data <span class="op">=</span> np.load(<span class="st">"ch5_data.npz"</span>)</span>
<span id="cb59-3"><a href="#cb59-3"></a>X0 <span class="op">=</span> data[<span class="st">"X"</span>]  <span class="co"># これまでのXをX0とする</span></span>
<span id="cb59-4"><a href="#cb59-4"></a>N <span class="op">=</span> data[<span class="st">"N"</span>]</span>
<span id="cb59-5"><a href="#cb59-5"></a>T <span class="op">=</span> data[<span class="st">"T"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># R</span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="fu">load</span>(<span class="st">'data/ch5_data.Rdata'</span>)</span>
<span id="cb60-3"><a href="#cb60-3"></a>X0 <span class="ot">&lt;-</span> X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>2次元データ生成 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># Python</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>np.random.seed(seed<span class="op">=</span><span class="dv">1</span>)  <span class="co"># 乱数を固定</span></span>
<span id="cb61-3"><a href="#cb61-3"></a>X1 <span class="op">=</span> <span class="dv">23</span> <span class="op">*</span> (T <span class="op">/</span> <span class="dv">100</span>) <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> np.random.randn(N)  <span class="co"># X1を生成</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>X0_min, X0_max <span class="op">=</span> <span class="dv">5</span>, <span class="dv">30</span>   <span class="co"># X0の下限と上限（表示用）</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>X1_min, X1_max <span class="op">=</span> <span class="dv">40</span>, <span class="dv">75</span>  <span class="co"># X1の下限と上限（表示用）</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="co"># R</span></span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)                             <span class="co"># 乱数を固定</span></span>
<span id="cb62-3"><a href="#cb62-3"></a>X1 <span class="ot">&lt;-</span> <span class="dv">23</span> <span class="sc">*</span> (t <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">rnorm</span>(N) <span class="co"># X1を生成</span></span>
<span id="cb62-4"><a href="#cb62-4"></a>X0_min <span class="ot">&lt;-</span> <span class="dv">5</span>; X0_max <span class="ot">&lt;-</span> <span class="dv">30</span>               <span class="co"># X0の下限と上限</span></span>
<span id="cb62-5"><a href="#cb62-5"></a>X1_min <span class="ot">&lt;-</span> <span class="dv">40</span>; X1_max <span class="ot">&lt;-</span> <span class="dv">75</span>              <span class="co"># X1の下限と上限</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-2-2" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-2-2">リスト 5-2-(2)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># Python</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="bu">print</span>(np.<span class="bu">round</span>(X0, <span class="dv">2</span>))</span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="bu">print</span>(np.<span class="bu">round</span>(X1, <span class="dv">2</span>))</span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="bu">print</span>(np.<span class="bu">round</span>(T, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="co"># R</span></span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="fu">print</span>(<span class="fu">round</span>(X0, <span class="dv">2</span>))</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="fu">print</span>(<span class="fu">round</span>(X1, <span class="dv">2</span>))</span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="fu">print</span>(<span class="fu">round</span>(t, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] 11.64 14.30 19.32 27.71 10.04 27.46 28.62 21.52 20.73  6.54 10.15  9.41
[13] 22.18 14.60 24.25 17.44</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 58.94 61.17 67.79 70.55 54.51 57.75 70.73 66.67 66.24 47.48 61.24 56.71
[13] 67.11 59.95 68.29 57.87</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 161.77 162.60 173.78 171.14 153.02 160.70 174.15 168.36 168.23 144.60
[11] 159.10 155.94 172.40 167.31 169.45 158.74</code></pre>
</div>
</div>
</section>
<section id="リスト-5-2-3" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-2-3">リスト 5-2-(3)</h4>
<p><strong>2次元データの表示 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a><span class="co"># Python</span></span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="kw">def</span> show_data2d(ax, x0, x1, t):  <span class="co"># axは3dグラフ描画のため</span></span>
<span id="cb68-3"><a href="#cb68-3"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(x0)):</span>
<span id="cb68-4"><a href="#cb68-4"></a>    ax.plot(  <span class="co"># データ点の下の直線の描画</span></span>
<span id="cb68-5"><a href="#cb68-5"></a>      [x0[i], x0[i]],       <span class="co"># 直線の両端のx座標</span></span>
<span id="cb68-6"><a href="#cb68-6"></a>      [x1[i], x1[i]],       <span class="co"># 直線の両端のy座標</span></span>
<span id="cb68-7"><a href="#cb68-7"></a>      [<span class="dv">120</span>, t[i]],          <span class="co"># 直線の両端のz座標</span></span>
<span id="cb68-8"><a href="#cb68-8"></a>      color<span class="op">=</span><span class="st">"gray"</span>,</span>
<span id="cb68-9"><a href="#cb68-9"></a>    )</span>
<span id="cb68-10"><a href="#cb68-10"></a>  ax.plot(      <span class="co"># データ点の描画</span></span>
<span id="cb68-11"><a href="#cb68-11"></a>    x0,                       <span class="co"># x座標</span></span>
<span id="cb68-12"><a href="#cb68-12"></a>    x1,                       <span class="co"># y座標</span></span>
<span id="cb68-13"><a href="#cb68-13"></a>    t,                        <span class="co"># z座標</span></span>
<span id="cb68-14"><a href="#cb68-14"></a>    <span class="st">"cornflowerblue"</span>,         <span class="co"># 色</span></span>
<span id="cb68-15"><a href="#cb68-15"></a>    marker<span class="op">=</span><span class="st">"o"</span>,               <span class="co"># マーカーの形状</span></span>
<span id="cb68-16"><a href="#cb68-16"></a>    linestyle<span class="op">=</span><span class="st">"None"</span>,         <span class="co"># 点をつなげる線は描かない</span></span>
<span id="cb68-17"><a href="#cb68-17"></a>    markeredgecolor<span class="op">=</span><span class="st">"black"</span>,  <span class="co"># マーカーの輪郭の色</span></span>
<span id="cb68-18"><a href="#cb68-18"></a>    markersize<span class="op">=</span><span class="dv">6</span>,             <span class="co"># マーカーのサイズ</span></span>
<span id="cb68-19"><a href="#cb68-19"></a>    markeredgewidth<span class="op">=</span><span class="fl">0.5</span>,      <span class="co"># マーカーの輪郭線の太さ</span></span>
<span id="cb68-20"><a href="#cb68-20"></a>  )</span>
<span id="cb68-21"><a href="#cb68-21"></a>  ax.view_init(elev<span class="op">=</span><span class="dv">35</span>, azim<span class="op">=-</span><span class="dv">75</span>)  <span class="co"># グラフの向きの指定</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># R</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>このリストにおけるRの操作は必要ない．</p>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># Python</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb70-3"><a href="#cb70-3"></a>ax <span class="op">=</span> plt.subplot(projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb70-4"><a href="#cb70-4"></a>show_data2d(ax, X0, X1, T)</span>
<span id="cb70-5"><a href="#cb70-5"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># R</span></span>
<span id="cb71-2"><a href="#cb71-2"></a>scatterplot3d<span class="sc">::</span><span class="fu">scatterplot3d</span>(<span class="at">x =</span> X0, <span class="at">y =</span> X1, <span class="at">z =</span> t, <span class="at">type =</span> <span class="st">'h'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>グラフ描画には<code>{scatterplot3d}</code>パッケージを用いた．</p>
</section>
<section id="リスト-5-2-4" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-2-4">リスト 5-2-(4)</h4>
<p><strong>面の表示 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># Python</span></span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="kw">def</span> show_plane(ax, w):</span>
<span id="cb72-3"><a href="#cb72-3"></a>    <span class="co"># 表示データの計算</span></span>
<span id="cb72-4"><a href="#cb72-4"></a>    x0_n, x1_n <span class="op">=</span> <span class="dv">5</span>, <span class="dv">5</span></span>
<span id="cb72-5"><a href="#cb72-5"></a>    x0 <span class="op">=</span> np.linspace(X0_min, X0_max, x0_n)</span>
<span id="cb72-6"><a href="#cb72-6"></a>    x1 <span class="op">=</span> np.linspace(X1_min, X1_max, x1_n)</span>
<span id="cb72-7"><a href="#cb72-7"></a>    xx0, xx1 <span class="op">=</span> np.meshgrid(x0, x1)  <span class="co"># グリッド座標の作成</span></span>
<span id="cb72-8"><a href="#cb72-8"></a>    y <span class="op">=</span> w[<span class="dv">0</span>] <span class="op">*</span> xx0 <span class="op">+</span> w[<span class="dv">1</span>] <span class="op">*</span> xx1 <span class="op">+</span> w[<span class="dv">2</span>]  <span class="co"># (A) 式5-28</span></span>
<span id="cb72-9"><a href="#cb72-9"></a>    <span class="co"># サーフェス表示</span></span>
<span id="cb72-10"><a href="#cb72-10"></a>    ax.plot_surface(</span>
<span id="cb72-11"><a href="#cb72-11"></a>        xx0, xx1, y,</span>
<span id="cb72-12"><a href="#cb72-12"></a>        rstride<span class="op">=</span><span class="dv">1</span>, cstride<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, color<span class="op">=</span><span class="st">"blue"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb72-13"><a href="#cb72-13"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># R</span></span>
<span id="cb73-2"><a href="#cb73-2"></a>show_plane <span class="ot">&lt;-</span> <span class="cf">function</span>(w) {</span>
<span id="cb73-3"><a href="#cb73-3"></a>  x0_n <span class="ot">&lt;-</span> <span class="dv">5</span>; x1_n <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>  x0 <span class="ot">&lt;-</span> <span class="fu">seq</span>(X0_min, X0_max, <span class="at">length.out =</span> x0_n)</span>
<span id="cb73-5"><a href="#cb73-5"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">seq</span>(X1_min, X1_max, <span class="at">length.out =</span> x1_n)</span>
<span id="cb73-6"><a href="#cb73-6"></a>  y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(x0_n, x1_n))</span>
<span id="cb73-7"><a href="#cb73-7"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>x0_n) {</span>
<span id="cb73-8"><a href="#cb73-8"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>x1_n) {</span>
<span id="cb73-9"><a href="#cb73-9"></a>      y[i, j] <span class="ot">&lt;-</span> w[<span class="dv">1</span>] <span class="sc">*</span> x0[i] <span class="sc">+</span> w[<span class="dv">2</span>] <span class="sc">*</span> x1[j] <span class="sc">+</span> w[<span class="dv">3</span>]</span>
<span id="cb73-10"><a href="#cb73-10"></a>    }</span>
<span id="cb73-11"><a href="#cb73-11"></a>  }</span>
<span id="cb73-12"><a href="#cb73-12"></a>  <span class="fu">persp</span>(x0, x1, y, <span class="at">theta =</span> <span class="dv">25</span>, <span class="at">phi =</span> <span class="dv">30</span>,</span>
<span id="cb73-13"><a href="#cb73-13"></a>        <span class="at">xlab =</span> <span class="st">''</span>, <span class="at">ylab =</span> <span class="st">''</span>, <span class="at">zlab =</span> <span class="st">''</span>)</span>
<span id="cb73-14"><a href="#cb73-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>面の平均二乗誤差(MSE)関数 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a><span class="co"># Python</span></span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="kw">def</span> mse_plane(x0, x1, t, w):</span>
<span id="cb74-3"><a href="#cb74-3"></a>  y <span class="op">=</span> w[<span class="dv">0</span>] <span class="op">*</span> x0 <span class="op">+</span> w[<span class="dv">1</span>] <span class="op">*</span> x1 <span class="op">+</span> w[<span class="dv">2</span>]  <span class="co"># (A) 式5-28</span></span>
<span id="cb74-4"><a href="#cb74-4"></a>  mse <span class="op">=</span> np.mean((y <span class="op">-</span> t) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb74-5"><a href="#cb74-5"></a>  <span class="cf">return</span> mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="co"># R</span></span>
<span id="cb75-2"><a href="#cb75-2"></a>mse_plane <span class="ot">&lt;-</span> <span class="cf">function</span>(x0, x1, t, w) {</span>
<span id="cb75-3"><a href="#cb75-3"></a>  y <span class="ot">&lt;-</span> w[<span class="dv">1</span>] <span class="sc">*</span> x0 <span class="sc">+</span> w[<span class="dv">2</span>] <span class="sc">*</span> x1 <span class="sc">+</span> w[<span class="dv">3</span>]</span>
<span id="cb75-4"><a href="#cb75-4"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((y <span class="sc">-</span> t) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb75-5"><a href="#cb75-5"></a>  <span class="fu">return</span>(mse)</span>
<span id="cb75-6"><a href="#cb75-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># Python</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>w <span class="op">=</span> np.array([<span class="fl">1.5</span>, <span class="dv">1</span>, <span class="dv">90</span>])</span>
<span id="cb76-3"><a href="#cb76-3"></a>mse <span class="op">=</span> mse_plane(X0, X1, T, w)  <span class="co"># MSEを計算</span></span>
<span id="cb76-4"><a href="#cb76-4"></a><span class="co"># 結果表示</span></span>
<span id="cb76-5"><a href="#cb76-5"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mse)<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="co"># R</span></span>
<span id="cb77-2"><a href="#cb77-2"></a>w <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">1</span>, <span class="dv">90</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb77-3"><a href="#cb77-3"></a>mse <span class="ot">&lt;-</span> <span class="fu">mse_plane</span>(X0, X1, t, w)</span>
<span id="cb77-4"><a href="#cb77-4"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">sqrt</span>(mse) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 17.76 cm</code></pre>
</div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="co"># Python</span></span>
<span id="cb79-2"><a href="#cb79-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb79-3"><a href="#cb79-3"></a>ax <span class="op">=</span> plt.subplot(projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb79-4"><a href="#cb79-4"></a>show_plane(ax, w)</span>
<span id="cb79-5"><a href="#cb79-5"></a>show_data2d(ax, X0, X1, T)</span>
<span id="cb79-6"><a href="#cb79-6"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># R</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="fu">show_plane</span>(w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-2-5" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-2-5">リスト 5-2-(5)</h4>
<p><strong>解析解 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="co"># Python</span></span>
<span id="cb81-2"><a href="#cb81-2"></a><span class="kw">def</span> fit_plane(x0, x1, t):  </span>
<span id="cb81-3"><a href="#cb81-3"></a>    c_tx0 <span class="op">=</span> np.mean(t <span class="op">*</span> x0) <span class="op">-</span> np.mean(t) <span class="op">*</span> np.mean(x0)     <span class="co"># cov(t, x0)</span></span>
<span id="cb81-4"><a href="#cb81-4"></a>    c_tx1 <span class="op">=</span> np.mean(t <span class="op">*</span> x1) <span class="op">-</span> np.mean(t) <span class="op">*</span> np.mean(x1)     <span class="co"># cov(t, x1)</span></span>
<span id="cb81-5"><a href="#cb81-5"></a>    c_x0x1 <span class="op">=</span> np.mean(x0 <span class="op">*</span> x1) <span class="op">-</span> np.mean(x0) <span class="op">*</span> np.mean(x1)  <span class="co"># cov(x0, x1)</span></span>
<span id="cb81-6"><a href="#cb81-6"></a>    v_x0 <span class="op">=</span> np.var(x0)                                      <span class="co"># var(x0)</span></span>
<span id="cb81-7"><a href="#cb81-7"></a>    v_x1 <span class="op">=</span> np.var(x1)                                      <span class="co"># var(x1)</span></span>
<span id="cb81-8"><a href="#cb81-8"></a>    <span class="co"># 式5-34</span></span>
<span id="cb81-9"><a href="#cb81-9"></a>    w0 <span class="op">=</span> (c_tx1 <span class="op">*</span> c_x0x1 <span class="op">-</span> v_x1 <span class="op">*</span> c_tx0) <span class="op">/</span> (c_x0x1 <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> v_x0 <span class="op">*</span> v_x1)</span>
<span id="cb81-10"><a href="#cb81-10"></a>    <span class="co"># 式5-35</span></span>
<span id="cb81-11"><a href="#cb81-11"></a>    w1 <span class="op">=</span> (c_tx0 <span class="op">*</span> c_x0x1 <span class="op">-</span> v_x0 <span class="op">*</span> c_tx1) <span class="op">/</span> (c_x0x1 <span class="op">**</span> <span class="dv">2</span> <span class="op">-</span> v_x0 <span class="op">*</span> v_x1)</span>
<span id="cb81-12"><a href="#cb81-12"></a>    <span class="co"># 式5-36</span></span>
<span id="cb81-13"><a href="#cb81-13"></a>    w2 <span class="op">=</span> <span class="op">-</span>w0 <span class="op">*</span> np.mean(x0) <span class="op">-</span> w1 <span class="op">*</span> np.mean(x1) <span class="op">+</span> np.mean(t)</span>
<span id="cb81-14"><a href="#cb81-14"></a>    w <span class="op">=</span> np.array([w0, w1, w2])</span>
<span id="cb81-15"><a href="#cb81-15"></a>    <span class="cf">return</span> w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="co"># R</span></span>
<span id="cb82-2"><a href="#cb82-2"></a>fit_plane <span class="ot">&lt;-</span> <span class="cf">function</span>(x0, x1, t) {</span>
<span id="cb82-3"><a href="#cb82-3"></a>  c_tx0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(t <span class="sc">*</span> x0) <span class="sc">-</span> <span class="fu">mean</span>(t) <span class="sc">*</span> <span class="fu">mean</span>(x0)    <span class="co"># cov(t, x0)</span></span>
<span id="cb82-4"><a href="#cb82-4"></a>  c_tx1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(t <span class="sc">*</span> x1) <span class="sc">-</span> <span class="fu">mean</span>(t) <span class="sc">*</span> <span class="fu">mean</span>(x1)    <span class="co"># cov(t, x1)</span></span>
<span id="cb82-5"><a href="#cb82-5"></a>  c_x0x1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(x0 <span class="sc">*</span> x1) <span class="sc">-</span> <span class="fu">mean</span>(x0) <span class="sc">*</span> <span class="fu">mean</span>(x1) <span class="co"># cov(x0, x1)</span></span>
<span id="cb82-6"><a href="#cb82-6"></a>  v_x0 <span class="ot">&lt;-</span> <span class="fu">var</span>(x0)                               <span class="co"># var(x0)</span></span>
<span id="cb82-7"><a href="#cb82-7"></a>  v_x1 <span class="ot">&lt;-</span> <span class="fu">var</span>(x1)                               <span class="co"># var(x1)</span></span>
<span id="cb82-8"><a href="#cb82-8"></a>  <span class="co"># 式5-34</span></span>
<span id="cb82-9"><a href="#cb82-9"></a>  w0 <span class="ot">&lt;-</span> (c_tx1 <span class="sc">*</span> c_x0x1 <span class="sc">-</span> v_x1 <span class="sc">*</span> c_tx0) <span class="sc">/</span> (c_x0x1 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> v_x0 <span class="sc">*</span> v_x1)</span>
<span id="cb82-10"><a href="#cb82-10"></a>  <span class="co"># 式5-35</span></span>
<span id="cb82-11"><a href="#cb82-11"></a>  w1 <span class="ot">&lt;-</span> (c_tx0 <span class="sc">*</span> c_x0x1 <span class="sc">-</span> v_x0 <span class="sc">*</span> c_tx1) <span class="sc">/</span> (c_x0x1 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">-</span> v_x0 <span class="sc">*</span> v_x1)</span>
<span id="cb82-12"><a href="#cb82-12"></a>  <span class="co"># 式5-36</span></span>
<span id="cb82-13"><a href="#cb82-13"></a>  w2 <span class="ot">&lt;-</span> <span class="sc">-</span>w0 <span class="sc">*</span> <span class="fu">mean</span>(x0) <span class="sc">-</span> w1 <span class="sc">*</span> <span class="fu">mean</span>(x1) <span class="sc">+</span> <span class="fu">mean</span>(t)</span>
<span id="cb82-14"><a href="#cb82-14"></a>  w <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(w0, w1, w2), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb82-15"><a href="#cb82-15"></a>  <span class="fu">return</span>(w)</span>
<span id="cb82-16"><a href="#cb82-16"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># Python</span></span>
<span id="cb83-2"><a href="#cb83-2"></a>w <span class="op">=</span> fit_plane(X0, X1, T)       <span class="co"># wを計算</span></span>
<span id="cb83-3"><a href="#cb83-3"></a>mse <span class="op">=</span> mse_plane(X0, X1, T, w)  <span class="co"># MSEを計算</span></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="co"># 結果表示</span></span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="bu">print</span>(<span class="ss">f"w0 = </span><span class="sc">{</span>w[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, w1 = </span><span class="sc">{</span>w[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">, w2 = </span><span class="sc">{</span>w[<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb83-6"><a href="#cb83-6"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mse)<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># R</span></span>
<span id="cb84-2"><a href="#cb84-2"></a>w <span class="ot">&lt;-</span> <span class="fu">fit_plane</span>(X0, X1, t)</span>
<span id="cb84-3"><a href="#cb84-3"></a>mse <span class="ot">&lt;-</span> <span class="fu">mse_plane</span>(X0, X1, t, w)</span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="fu">cat</span>(<span class="st">'w0 ='</span>, <span class="fu">round</span>(w[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">'w1 ='</span>, <span class="fu">round</span>(w[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">'w2 ='</span>, <span class="fu">round</span>(w[<span class="dv">3</span>], <span class="dv">2</span>))</span>
<span id="cb84-5"><a href="#cb84-5"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">sqrt</span>(mse) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>w0 = 0.17 w1 = 1 w2 = 98.61</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 2.47 cm</code></pre>
</div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># Python</span></span>
<span id="cb87-2"><a href="#cb87-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb87-3"><a href="#cb87-3"></a>ax <span class="op">=</span> plt.subplot(projection<span class="op">=</span><span class="st">"3d"</span>)</span>
<span id="cb87-4"><a href="#cb87-4"></a>show_plane(ax, w)</span>
<span id="cb87-5"><a href="#cb87-5"></a>show_data2d(ax, X0, X1, T)</span>
<span id="cb87-6"><a href="#cb87-6"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># R</span></span>
<span id="cb88-2"><a href="#cb88-2"></a><span class="fu">show_plane</span>(w)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="第3節" class="level3">
<h3 class="anchored" data-anchor-id="第3節">第3節</h3>
<section id="リセット-1" class="level4">
<h4 class="anchored" data-anchor-id="リセット-1">リセット</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># Python</span></span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="op">%</span>reset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="co"># R</span></span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="st">'myf'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注意
</div>
</div>
<div class="callout-body-container callout-body">
<p>フォントを指定している<code>myf</code>オブジェクトは消さない．</p>
</div>
</div>
</section>
<section id="リスト-5-3-1" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-1">リスト 5-3-(1)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a><span class="co"># Python</span></span>
<span id="cb91-2"><a href="#cb91-2"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb91-3"><a href="#cb91-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb91-4"><a href="#cb91-4"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># R</span></span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>データのロード ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="co"># Python</span></span>
<span id="cb93-2"><a href="#cb93-2"></a>data <span class="op">=</span> np.load(<span class="st">"ch5_data.npz"</span>)</span>
<span id="cb93-3"><a href="#cb93-3"></a>X <span class="op">=</span> data[<span class="st">"X"</span>]</span>
<span id="cb93-4"><a href="#cb93-4"></a>X_min <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb93-5"><a href="#cb93-5"></a>X_max <span class="op">=</span> data[<span class="st">"X_max"</span>]</span>
<span id="cb93-6"><a href="#cb93-6"></a>N <span class="op">=</span> data[<span class="st">"N"</span>]</span>
<span id="cb93-7"><a href="#cb93-7"></a>T <span class="op">=</span> data[<span class="st">"T"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="co"># R</span></span>
<span id="cb94-2"><a href="#cb94-2"></a><span class="fu">load</span>(<span class="st">'data/ch5_data.Rdata'</span>)</span>
<span id="cb94-3"><a href="#cb94-3"></a>X_min <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-3-2" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-2">リスト 5-3-(2)</h4>
<p><strong>ガウス関数 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a><span class="co"># Python</span></span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="kw">def</span> gauss(x, mu, s):</span>
<span id="cb95-3"><a href="#cb95-3"></a>    y <span class="op">=</span> np.exp(<span class="op">-</span>((x <span class="op">-</span> mu) <span class="op">**</span> <span class="dv">2</span>) <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> s <span class="op">**</span> <span class="dv">2</span>))  <span class="co"># 式5-64</span></span>
<span id="cb95-4"><a href="#cb95-4"></a>    <span class="cf">return</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="co"># R</span></span>
<span id="cb96-2"><a href="#cb96-2"></a>gauss <span class="ot">&lt;-</span> <span class="cf">function</span>(x, mu, s) {</span>
<span id="cb96-3"><a href="#cb96-3"></a>  y <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>((x <span class="sc">-</span> mu) <span class="sc">^</span> <span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> s <span class="sc">^</span> <span class="dv">2</span>)) <span class="co"># 式5-64</span></span>
<span id="cb96-4"><a href="#cb96-4"></a>  <span class="fu">return</span>(y)</span>
<span id="cb96-5"><a href="#cb96-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-3-3" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-3">リスト 5-3-(3)</h4>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># Python</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>M <span class="op">=</span> <span class="dv">4</span>                                <span class="co"># ガウス関数の数</span></span>
<span id="cb97-3"><a href="#cb97-3"></a>mu <span class="op">=</span> np.linspace(<span class="dv">5</span>, <span class="dv">30</span>, M)           <span class="co"># 平均パラメータ</span></span>
<span id="cb97-4"><a href="#cb97-4"></a>s <span class="op">=</span> mu[<span class="dv">1</span>] <span class="op">-</span> mu[<span class="dv">0</span>]                    <span class="co"># (A) 標準偏差パラメータ</span></span>
<span id="cb97-5"><a href="#cb97-5"></a>xb <span class="op">=</span> np.linspace(X_min, X_max, <span class="dv">100</span>)</span>
<span id="cb97-6"><a href="#cb97-6"></a>y <span class="op">=</span> np.zeros((M, <span class="dv">100</span>))  <span class="co"># M個のガウス関数の値を入れるyを準備</span></span>
<span id="cb97-7"><a href="#cb97-7"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(M):</span>
<span id="cb97-8"><a href="#cb97-8"></a>    y[j, :] <span class="op">=</span> gauss(xb, mu[j], s)    <span class="co"># ガウス関数</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="co"># R</span></span>
<span id="cb98-2"><a href="#cb98-2"></a>M <span class="ot">&lt;-</span> <span class="dv">4</span>                           <span class="co"># ガウス関数の数</span></span>
<span id="cb98-3"><a href="#cb98-3"></a>mu <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">30</span>, <span class="at">length.out =</span> M) <span class="co"># 平均パラメタ</span></span>
<span id="cb98-4"><a href="#cb98-4"></a>s <span class="ot">&lt;-</span> mu[<span class="dv">2</span>] <span class="sc">-</span> mu[<span class="dv">1</span>]               <span class="co"># (A) 標準偏差パラメタ</span></span>
<span id="cb98-5"><a href="#cb98-5"></a>xb <span class="ot">&lt;-</span> <span class="fu">seq</span>(X_min, X_max, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb98-6"><a href="#cb98-6"></a>y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">100</span>, M)) <span class="sc">|&gt;</span></span>
<span id="cb98-7"><a href="#cb98-7"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb98-8"><a href="#cb98-8"></a>  <span class="fu">rename</span>(<span class="at">mu1 =</span> <span class="st">'X1'</span>, <span class="at">mu2 =</span> <span class="st">'X2'</span>, <span class="at">mu3 =</span> <span class="st">'X3'</span>, <span class="at">mu4 =</span> <span class="st">'X4'</span>)</span>
<span id="cb98-9"><a href="#cb98-9"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M) {</span>
<span id="cb98-10"><a href="#cb98-10"></a>  y[, j] <span class="ot">&lt;-</span> <span class="fu">gauss</span>(xb, mu[j], s)  <span class="co"># ガウス関数</span></span>
<span id="cb98-11"><a href="#cb98-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>{ggplot2}</code>で描画する際のデータには，<strong>tidy</strong>であることが望ましいため，便宜上<code>y</code>の行数と列数を入れ替えている．</p>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># Python</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb99-3"><a href="#cb99-3"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(M):</span>
<span id="cb99-4"><a href="#cb99-4"></a>    plt.plot(xb, y[j, :], <span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb99-5"><a href="#cb99-5"></a>    plt.xlim(X_min, X_max)</span>
<span id="cb99-6"><a href="#cb99-6"></a>    plt.ylim(<span class="dv">0</span>, <span class="fl">1.2</span>)</span>
<span id="cb99-7"><a href="#cb99-7"></a>    plt.grid()</span>
<span id="cb99-8"><a href="#cb99-8"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># R</span></span>
<span id="cb100-2"><a href="#cb100-2"></a>y <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(y),</span>
<span id="cb100-4"><a href="#cb100-4"></a>               <span class="at">names_to =</span> <span class="st">'mu'</span>,</span>
<span id="cb100-5"><a href="#cb100-5"></a>               <span class="at">values_to =</span> <span class="st">'gauss'</span>) <span class="sc">|&gt;</span></span>
<span id="cb100-6"><a href="#cb100-6"></a>  <span class="fu">mutate</span>(<span class="at">x_plt =</span> <span class="fu">rep</span>(xb, <span class="at">each =</span> <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb100-7"><a href="#cb100-7"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb100-8"><a href="#cb100-8"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> gauss,</span>
<span id="cb100-9"><a href="#cb100-9"></a>                <span class="at">color =</span> mu)) <span class="sc">+</span></span>
<span id="cb100-10"><a href="#cb100-10"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb100-11"><a href="#cb100-11"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">30</span> <span class="sc">/</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb100-12"><a href="#cb100-12"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb100-13"><a href="#cb100-13"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb100-14"><a href="#cb100-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><code>pivot_longer()</code>は，wideな(tidyではない)データをlongな(tidyである)データに変換する関数である．<code>cols</code>引数で変換する列を選択し，<code>names_to</code>, <code>values_to</code>引数で変換後の列名を指定している(詳しい解説は<a href="https://www.jaysong.net/RBook/tidydata.html">宋・矢内『私たちのR』第17章</a>を参照されたい)．</p>
</section>
<section id="リスト-5-3-4" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-4">リスト 5-3-(4)</h4>
<p><strong>線形基底関数モデル ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># Python</span></span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="kw">def</span> gauss_func(w, x):</span>
<span id="cb101-3"><a href="#cb101-3"></a>    m <span class="op">=</span> <span class="bu">len</span>(w) <span class="op">-</span> <span class="dv">1</span>        <span class="co"># ガウス関数の数</span></span>
<span id="cb101-4"><a href="#cb101-4"></a>    mu <span class="op">=</span> np.linspace(<span class="dv">5</span>, <span class="dv">30</span>, m)</span>
<span id="cb101-5"><a href="#cb101-5"></a>    s <span class="op">=</span> mu[<span class="dv">1</span>] <span class="op">-</span> mu[<span class="dv">0</span>]</span>
<span id="cb101-6"><a href="#cb101-6"></a>    <span class="co"># xと同じサイズで要素が0のndarray型を作成</span></span>
<span id="cb101-7"><a href="#cb101-7"></a>    y <span class="op">=</span> np.zeros_like(x)</span>
<span id="cb101-8"><a href="#cb101-8"></a>    <span class="co"># ここでは式5-66ではなく式5-65で実装</span></span>
<span id="cb101-9"><a href="#cb101-9"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(m):</span>
<span id="cb101-10"><a href="#cb101-10"></a>        y <span class="op">=</span> y <span class="op">+</span> w[j] <span class="op">*</span> gauss(x, mu[j], s)</span>
<span id="cb101-11"><a href="#cb101-11"></a>    y <span class="op">=</span> y <span class="op">+</span> w[m]  <span class="co"># phiを掛けないパラメータを最後に加える</span></span>
<span id="cb101-12"><a href="#cb101-12"></a>    <span class="cf">return</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="co"># R</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>gauss_func <span class="ot">&lt;-</span> <span class="cf">function</span>(w, x) {</span>
<span id="cb102-3"><a href="#cb102-3"></a>  m <span class="ot">&lt;-</span> <span class="fu">length</span>(w) <span class="sc">-</span> <span class="dv">1</span>                      <span class="co"># ガウス関数の数 </span></span>
<span id="cb102-4"><a href="#cb102-4"></a>  mu <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">30</span>, <span class="at">length.out =</span> m)</span>
<span id="cb102-5"><a href="#cb102-5"></a>  s <span class="ot">=</span> mu[<span class="dv">2</span>] <span class="sc">-</span> mu[<span class="dv">1</span>]</span>
<span id="cb102-6"><a href="#cb102-6"></a>  <span class="co"># xと同じサイズで要素が0のarray型を作成</span></span>
<span id="cb102-7"><a href="#cb102-7"></a>  y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">length</span>(x)))</span>
<span id="cb102-8"><a href="#cb102-8"></a>  <span class="co"># ここでは式5-66ではなく式5-65で実装</span></span>
<span id="cb102-9"><a href="#cb102-9"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {</span>
<span id="cb102-10"><a href="#cb102-10"></a>    y <span class="ot">&lt;-</span> y <span class="sc">+</span> w[j] <span class="sc">*</span> <span class="fu">gauss</span>(x, mu[j], s)</span>
<span id="cb102-11"><a href="#cb102-11"></a>  }</span>
<span id="cb102-12"><a href="#cb102-12"></a>  y <span class="ot">&lt;-</span> y <span class="sc">+</span> w[m <span class="sc">+</span> <span class="dv">1</span>]                       <span class="co"># phiをかけないパラメタを最後に加える</span></span>
<span id="cb102-13"><a href="#cb102-13"></a>  <span class="fu">return</span>(y)</span>
<span id="cb102-14"><a href="#cb102-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-3-5" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-5">リスト 5-3-(5)</h4>
<p><strong>線形基底関数モデルの平均二乗誤差(MSE) ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a><span class="co"># Python</span></span>
<span id="cb103-2"><a href="#cb103-2"></a><span class="kw">def</span> mse_gauss_func(x, t, w):</span>
<span id="cb103-3"><a href="#cb103-3"></a>    y <span class="op">=</span> gauss_func(w, x)</span>
<span id="cb103-4"><a href="#cb103-4"></a>    mse <span class="op">=</span> np.mean((y <span class="op">-</span> t) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb103-5"><a href="#cb103-5"></a>    <span class="cf">return</span> mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># R</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>mse_gauss_func <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, w) {</span>
<span id="cb104-3"><a href="#cb104-3"></a>  y <span class="ot">&lt;-</span> <span class="fu">gauss_func</span>(w, x)</span>
<span id="cb104-4"><a href="#cb104-4"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((y <span class="sc">-</span> t) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb104-5"><a href="#cb104-5"></a>  <span class="fu">return</span>(mse)</span>
<span id="cb104-6"><a href="#cb104-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-3-6" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-6">リスト 5-3-(6)</h4>
<p><strong>線形基底関数モデルの厳密解 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a><span class="co"># R</span></span>
<span id="cb105-2"><a href="#cb105-2"></a><span class="kw">def</span> fit_gauss_func(x, t, m):</span>
<span id="cb105-3"><a href="#cb105-3"></a>    mu <span class="op">=</span> np.linspace(<span class="dv">5</span>, <span class="dv">30</span>, m)</span>
<span id="cb105-4"><a href="#cb105-4"></a>    s <span class="op">=</span> mu[<span class="dv">1</span>] <span class="op">-</span> mu[<span class="dv">0</span>]</span>
<span id="cb105-5"><a href="#cb105-5"></a>    n <span class="op">=</span> x.shape[<span class="dv">0</span>]</span>
<span id="cb105-6"><a href="#cb105-6"></a>    <span class="co"># 式5-69 の計画行列phiを作成</span></span>
<span id="cb105-7"><a href="#cb105-7"></a>    phi <span class="op">=</span> np.ones((n, m <span class="op">+</span> <span class="dv">1</span>))  <span class="co"># (A) 要素が1のn x (m+1)行列</span></span>
<span id="cb105-8"><a href="#cb105-8"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(m):         <span class="co"># (B) 0～m-1列に値を割り振る</span></span>
<span id="cb105-9"><a href="#cb105-9"></a>        phi[:, j] <span class="op">=</span> gauss(x, mu[j], s)</span>
<span id="cb105-10"><a href="#cb105-10"></a>    <span class="co"># 式5-68 で厳密解のwを計算</span></span>
<span id="cb105-11"><a href="#cb105-11"></a>    w <span class="op">=</span> np.linalg.inv(phi.T <span class="op">@</span> phi) <span class="op">@</span> phi.T <span class="op">@</span> t</span>
<span id="cb105-12"><a href="#cb105-12"></a>    <span class="cf">return</span> w</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a><span class="co"># R</span></span>
<span id="cb106-2"><a href="#cb106-2"></a>fit_gauss_func <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, m) {</span>
<span id="cb106-3"><a href="#cb106-3"></a>  mu <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">30</span>, <span class="at">length.out =</span> m)</span>
<span id="cb106-4"><a href="#cb106-4"></a>  s <span class="ot">&lt;-</span> mu[<span class="dv">2</span>] <span class="sc">-</span> mu[<span class="dv">1</span>]</span>
<span id="cb106-5"><a href="#cb106-5"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb106-6"><a href="#cb106-6"></a>  <span class="co"># 式5-69 の計画行列phiを作成</span></span>
<span id="cb106-7"><a href="#cb106-7"></a>  phi <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span>, <span class="at">dim =</span> <span class="fu">c</span>(n, m <span class="sc">+</span> <span class="dv">1</span>)) <span class="co"># (A) 要素が1のn x (m + 1)行列</span></span>
<span id="cb106-8"><a href="#cb106-8"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>m) {                   <span class="co"># (B) 0 ~ (m - 1)列に値を割り振る</span></span>
<span id="cb106-9"><a href="#cb106-9"></a>    phi[, j] <span class="ot">&lt;-</span> <span class="fu">gauss</span>(x, mu[j], s)</span>
<span id="cb106-10"><a href="#cb106-10"></a>  }</span>
<span id="cb106-11"><a href="#cb106-11"></a>  <span class="co"># 式5-68 で厳密解のwを計算</span></span>
<span id="cb106-12"><a href="#cb106-12"></a>  w <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(phi) <span class="sc">%*%</span> phi) <span class="sc">%*%</span> <span class="fu">t</span>(phi) <span class="sc">%*%</span> t</span>
<span id="cb106-13"><a href="#cb106-13"></a>  <span class="fu">return</span>(w)</span>
<span id="cb106-14"><a href="#cb106-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-3-7" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-7">リスト 5-3-(7)</h4>
<p><strong>ガウス基底関数表示 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a><span class="co"># Python</span></span>
<span id="cb107-2"><a href="#cb107-2"></a><span class="kw">def</span> show_gauss_func(w):</span>
<span id="cb107-3"><a href="#cb107-3"></a>    x <span class="op">=</span> np.linspace(X_min, X_max, <span class="dv">100</span>)</span>
<span id="cb107-4"><a href="#cb107-4"></a>    y <span class="op">=</span> gauss_func(w, x)</span>
<span id="cb107-5"><a href="#cb107-5"></a>    plt.plot(x, y, <span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="co"># R</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>show_gauss_func <span class="ot">&lt;-</span> <span class="cf">function</span>(w) {</span>
<span id="cb108-3"><a href="#cb108-3"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(X_min, X_max, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb108-4"><a href="#cb108-4"></a>  y <span class="ot">&lt;-</span> <span class="fu">gauss_func</span>(w, x)</span>
<span id="cb108-5"><a href="#cb108-5"></a>  p <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> x, <span class="at">y_plt =</span> y <span class="sc">|&gt;</span> <span class="fu">as.vector</span>()) <span class="sc">|&gt;</span></span>
<span id="cb108-6"><a href="#cb108-6"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb108-7"><a href="#cb108-7"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb108-8"><a href="#cb108-8"></a>              <span class="at">color =</span> <span class="st">'gray'</span>) <span class="sc">+</span></span>
<span id="cb108-9"><a href="#cb108-9"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> myf)</span>
<span id="cb108-10"><a href="#cb108-10"></a>  <span class="fu">return</span>(p)</span>
<span id="cb108-11"><a href="#cb108-11"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a><span class="co"># Python</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>M <span class="op">=</span> <span class="dv">4</span>                          <span class="co"># ガウス関数の数</span></span>
<span id="cb109-3"><a href="#cb109-3"></a>w <span class="op">=</span> fit_gauss_func(X, T, M)    <span class="co"># wを計算</span></span>
<span id="cb109-4"><a href="#cb109-4"></a>mse <span class="op">=</span> mse_gauss_func(X, T, w)  <span class="co"># MSEを計算</span></span>
<span id="cb109-5"><a href="#cb109-5"></a><span class="co"># 結果表示</span></span>
<span id="cb109-6"><a href="#cb109-6"></a><span class="bu">print</span>(<span class="st">"w = "</span>, np.<span class="bu">round</span>(w, <span class="dv">2</span>))</span>
<span id="cb109-7"><a href="#cb109-7"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mse)<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a><span class="co"># R</span></span>
<span id="cb110-2"><a href="#cb110-2"></a>M <span class="ot">&lt;-</span> <span class="dv">4</span>                         <span class="co"># ガウス関数の数</span></span>
<span id="cb110-3"><a href="#cb110-3"></a>w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(X, t, M)   <span class="co"># wを計算</span></span>
<span id="cb110-4"><a href="#cb110-4"></a>mse <span class="ot">&lt;-</span> <span class="fu">mse_gauss_func</span>(X, t, w) <span class="co"># MSEを計算</span></span>
<span id="cb110-5"><a href="#cb110-5"></a><span class="co"># 結果表示</span></span>
<span id="cb110-6"><a href="#cb110-6"></a><span class="fu">cat</span>(<span class="st">'w ='</span>, <span class="fu">round</span>(w, <span class="dv">2</span>))</span>
<span id="cb110-7"><a href="#cb110-7"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">sqrt</span>(mse) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>w = 3.81 42.59 2.41 49.8 109.95</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 4.02 cm</code></pre>
</div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># Python</span></span>
<span id="cb113-2"><a href="#cb113-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb113-3"><a href="#cb113-3"></a>show_gauss_func(w)</span>
<span id="cb113-4"><a href="#cb113-4"></a>plt.plot(</span>
<span id="cb113-5"><a href="#cb113-5"></a>    X, T, <span class="st">"cornflowerblue"</span>, </span>
<span id="cb113-6"><a href="#cb113-6"></a>    marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb113-7"><a href="#cb113-7"></a>)</span>
<span id="cb113-8"><a href="#cb113-8"></a>plt.xlim(X_min, X_max)</span>
<span id="cb113-9"><a href="#cb113-9"></a>plt.grid()</span>
<span id="cb113-10"><a href="#cb113-10"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a><span class="co"># R</span></span>
<span id="cb114-2"><a href="#cb114-2"></a><span class="fu">show_gauss_func</span>(w) <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb114-4"><a href="#cb114-4"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb114-5"><a href="#cb114-5"></a>             <span class="at">color   =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb114-6"><a href="#cb114-6"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">120</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">30</span> <span class="sc">/</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb114-8"><a href="#cb114-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'年齢x'</span>, <span class="at">y =</span> <span class="st">'身長t'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-3-8" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-8">リスト 5-3-(8)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># Python</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>M <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>]                    <span class="co"># 調べるMの値</span></span>
<span id="cb115-3"><a href="#cb115-3"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="fl">2.5</span>))</span>
<span id="cb115-4"><a href="#cb115-4"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb115-5"><a href="#cb115-5"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(M)):</span>
<span id="cb115-6"><a href="#cb115-6"></a>    plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(M), i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb115-7"><a href="#cb115-7"></a>    w <span class="op">=</span> fit_gauss_func(X, T, M[i])  <span class="co"># wを計算</span></span>
<span id="cb115-8"><a href="#cb115-8"></a>    mse <span class="op">=</span> mse_gauss_func(X, T, w)   <span class="co"># MSEを計算</span></span>
<span id="cb115-9"><a href="#cb115-9"></a>    <span class="co"># グラフ描画</span></span>
<span id="cb115-10"><a href="#cb115-10"></a>    show_gauss_func(w)  <span class="co"># 線形基底関数</span></span>
<span id="cb115-11"><a href="#cb115-11"></a>    plt.plot(           <span class="co"># データ点</span></span>
<span id="cb115-12"><a href="#cb115-12"></a>        X, T, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb115-13"><a href="#cb115-13"></a>        marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb115-14"><a href="#cb115-14"></a>    )</span>
<span id="cb115-15"><a href="#cb115-15"></a>    plt.title(<span class="ss">f"M=</span><span class="sc">{</span>M[i]<span class="sc">:d}</span><span class="ss">, SD=</span><span class="sc">{</span>np<span class="sc">.</span>sqrt(mse)<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb115-16"><a href="#cb115-16"></a>    plt.xlim(X_min, X_max)</span>
<span id="cb115-17"><a href="#cb115-17"></a>    plt.ylim(<span class="dv">120</span>, <span class="dv">180</span>)</span>
<span id="cb115-18"><a href="#cb115-18"></a>    plt.grid()</span>
<span id="cb115-19"><a href="#cb115-19"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># R</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>M <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>)                <span class="co"># 調べるMの値</span></span>
<span id="cb116-3"><a href="#cb116-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb116-4"><a href="#cb116-4"></a>  w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(X, t, M[i]) <span class="co"># wを計算</span></span>
<span id="cb116-5"><a href="#cb116-5"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mse_gauss_func</span>(X, t, w)  <span class="co"># MSEを計算</span></span>
<span id="cb116-6"><a href="#cb116-6"></a>  p <span class="ot">&lt;-</span> <span class="fu">show_gauss_func</span>(w) <span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7"></a>    <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb116-8"><a href="#cb116-8"></a>               <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb116-9"><a href="#cb116-9"></a>               <span class="at">color   =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb116-10"><a href="#cb116-10"></a>    <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">120</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb116-11"><a href="#cb116-11"></a>    <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">30</span> <span class="sc">/</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb116-12"><a href="#cb116-12"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-13"><a href="#cb116-13"></a>         <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'SD ='</span>, <span class="fu">sqrt</span>(mse) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb116-14"><a href="#cb116-14"></a>                       <span class="sc">|&gt;</span> <span class="fu">as.character</span>(), <span class="st">'cm'</span>))</span>
<span id="cb116-15"><a href="#cb116-15"></a>  <span class="fu">plot</span>(p)</span>
<span id="cb116-16"><a href="#cb116-16"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-102-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-102-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-102-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="リスト-5-3-9" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-9">リスト 5-3-(9)</h4>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a><span class="co"># Python</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>M <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">10</span>)</span>
<span id="cb117-3"><a href="#cb117-3"></a>sd <span class="op">=</span> np.zeros(<span class="bu">len</span>(M))</span>
<span id="cb117-4"><a href="#cb117-4"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(M)):</span>
<span id="cb117-5"><a href="#cb117-5"></a>    w <span class="op">=</span> fit_gauss_func(X, T, M[i])            <span class="co"># wを計算</span></span>
<span id="cb117-6"><a href="#cb117-6"></a>    sd[i] <span class="op">=</span> np.sqrt(mse_gauss_func(X, T, w))  <span class="co"># SDを計算</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># R</span></span>
<span id="cb118-2"><a href="#cb118-2"></a>M <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span></span>
<span id="cb118-3"><a href="#cb118-3"></a>sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(M))</span>
<span id="cb118-4"><a href="#cb118-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb118-5"><a href="#cb118-5"></a>  w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(X, t, M[i])        <span class="co"># wを計算</span></span>
<span id="cb118-6"><a href="#cb118-6"></a>  sd[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mse_gauss_func</span>(X, t, w)) <span class="co"># SDを計算</span></span>
<span id="cb118-7"><a href="#cb118-7"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a><span class="co"># Python</span></span>
<span id="cb119-2"><a href="#cb119-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb119-3"><a href="#cb119-3"></a>plt.plot(M, sd, <span class="st">"cornflowerblue"</span>, marker<span class="op">=</span><span class="st">"o"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb119-4"><a href="#cb119-4"></a>plt.grid()</span>
<span id="cb119-5"><a href="#cb119-5"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># R</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="fu">tibble</span>(<span class="at">x_plt =</span> M, <span class="at">y_plt =</span> sd) <span class="sc">|&gt;</span></span>
<span id="cb120-3"><a href="#cb120-3"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb120-4"><a href="#cb120-4"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb120-5"><a href="#cb120-5"></a>            <span class="at">color =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb120-6"><a href="#cb120-6"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb120-7"><a href="#cb120-7"></a>             <span class="at">fill =</span> <span class="st">'cornflowerblue'</span>,</span>
<span id="cb120-8"><a href="#cb120-8"></a>             <span class="at">color =</span> <span class="st">'black'</span>,</span>
<span id="cb120-9"><a href="#cb120-9"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb120-10"><a href="#cb120-10"></a>  <span class="fu">xlim</span>(<span class="dv">2</span>, <span class="dv">9</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="fl">3.00</span>, <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb120-11"><a href="#cb120-11"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">7</span> <span class="sc">/</span> (<span class="fl">4.5</span> <span class="sc">-</span> <span class="fl">3.00</span>)) <span class="sc">+</span></span>
<span id="cb120-12"><a href="#cb120-12"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb120-13"><a href="#cb120-13"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb120-14"><a href="#cb120-14"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'M'</span>, <span class="at">y =</span> <span class="st">'SD'</span>) <span class="sc">+</span></span>
<span id="cb120-15"><a href="#cb120-15"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-3-10" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-10">リスト 5-3-(10)</h4>
<p><strong>訓練データとテストデータに分割———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a><span class="co"># Python</span></span>
<span id="cb121-2"><a href="#cb121-2"></a>split <span class="op">=</span> <span class="bu">int</span>(N <span class="op">/</span> <span class="dv">4</span>)  <span class="co"># 分割するインデックス</span></span>
<span id="cb121-3"><a href="#cb121-3"></a>X_test <span class="op">=</span> X[:split]</span>
<span id="cb121-4"><a href="#cb121-4"></a>T_test <span class="op">=</span> T[:split]</span>
<span id="cb121-5"><a href="#cb121-5"></a>X_train <span class="op">=</span> X[split:]</span>
<span id="cb121-6"><a href="#cb121-6"></a>T_train <span class="op">=</span> T[split:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="co"># R</span></span>
<span id="cb122-2"><a href="#cb122-2"></a>split <span class="ot">&lt;-</span> N <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb122-3"><a href="#cb122-3"></a>X_test <span class="ot">&lt;-</span> X[<span class="dv">1</span><span class="sc">:</span>split]</span>
<span id="cb122-4"><a href="#cb122-4"></a>T_test <span class="ot">&lt;-</span> t[<span class="dv">1</span><span class="sc">:</span>split]</span>
<span id="cb122-5"><a href="#cb122-5"></a>X_train <span class="ot">&lt;-</span> X[(split<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(X)]</span>
<span id="cb122-6"><a href="#cb122-6"></a>T_train <span class="ot">&lt;-</span> t[(split<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(t)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a><span class="co"># Python</span></span>
<span id="cb123-2"><a href="#cb123-2"></a>M <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>]  <span class="co"># 調べるMの値</span></span>
<span id="cb123-3"><a href="#cb123-3"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="fl">2.5</span>))</span>
<span id="cb123-4"><a href="#cb123-4"></a>plt.subplots_adjust(wspace<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb123-5"><a href="#cb123-5"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(M)):</span>
<span id="cb123-6"><a href="#cb123-6"></a>    w <span class="op">=</span> fit_gauss_func(X_train, T_train, M[i])       <span class="co"># wを計算</span></span>
<span id="cb123-7"><a href="#cb123-7"></a>    sd <span class="op">=</span> np.sqrt(mse_gauss_func(X_test, T_test, w))  <span class="co"># SDを計算</span></span>
<span id="cb123-8"><a href="#cb123-8"></a>    <span class="co"># グラフ描画</span></span>
<span id="cb123-9"><a href="#cb123-9"></a>    plt.subplot(<span class="dv">1</span>, <span class="bu">len</span>(M), i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb123-10"><a href="#cb123-10"></a>    show_gauss_func(w)  <span class="co"># 線形基底関数</span></span>
<span id="cb123-11"><a href="#cb123-11"></a>    plt.plot(           <span class="co"># 訓練データ</span></span>
<span id="cb123-12"><a href="#cb123-12"></a>        X_train, T_train, <span class="st">"white"</span>,</span>
<span id="cb123-13"><a href="#cb123-13"></a>        marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>, </span>
<span id="cb123-14"><a href="#cb123-14"></a>        label<span class="op">=</span><span class="st">"training"</span>,</span>
<span id="cb123-15"><a href="#cb123-15"></a>    )</span>
<span id="cb123-16"><a href="#cb123-16"></a>    plt.plot(           <span class="co"># テストデータ</span></span>
<span id="cb123-17"><a href="#cb123-17"></a>        X_test, T_test, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb123-18"><a href="#cb123-18"></a>        marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb123-19"><a href="#cb123-19"></a>        label<span class="op">=</span><span class="st">"test"</span>,</span>
<span id="cb123-20"><a href="#cb123-20"></a>    )</span>
<span id="cb123-21"><a href="#cb123-21"></a>    plt.title(<span class="ss">f"M=</span><span class="sc">{</span>M[i]<span class="sc">:d}</span><span class="ss">, SD=</span><span class="sc">{</span>sd<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb123-22"><a href="#cb123-22"></a>    plt.legend(loc<span class="op">=</span><span class="st">"lower right"</span>, fontsize<span class="op">=</span><span class="dv">10</span>, numpoints<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb123-23"><a href="#cb123-23"></a>    plt.xlim(X_min, X_max)</span>
<span id="cb123-24"><a href="#cb123-24"></a>    plt.ylim(<span class="dv">120</span>, <span class="dv">180</span>)</span>
<span id="cb123-25"><a href="#cb123-25"></a>    plt.grid()</span>
<span id="cb123-26"><a href="#cb123-26"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="co"># R</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>M <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>)</span>
<span id="cb124-3"><a href="#cb124-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb124-4"><a href="#cb124-4"></a>  w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(X_train, T_train, M[i])</span>
<span id="cb124-5"><a href="#cb124-5"></a>  sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mse_gauss_func</span>(X_test, T_test, w))</span>
<span id="cb124-6"><a href="#cb124-6"></a>  p <span class="ot">&lt;-</span> <span class="fu">show_gauss_func</span>(w) <span class="sc">+</span></span>
<span id="cb124-7"><a href="#cb124-7"></a>    <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X_train, <span class="at">y_plt =</span> T_train),</span>
<span id="cb124-8"><a href="#cb124-8"></a>               <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb124-9"><a href="#cb124-9"></a>               <span class="at">fill    =</span> <span class="st">'white'</span>,</span>
<span id="cb124-10"><a href="#cb124-10"></a>               <span class="at">color   =</span> <span class="st">'black'</span>,</span>
<span id="cb124-11"><a href="#cb124-11"></a>               <span class="at">shape   =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb124-12"><a href="#cb124-12"></a>    <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X_test, <span class="at">y_plt =</span> T_test),</span>
<span id="cb124-13"><a href="#cb124-13"></a>               <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb124-14"><a href="#cb124-14"></a>               <span class="at">fill    =</span> <span class="st">'cornflowerblue'</span>,</span>
<span id="cb124-15"><a href="#cb124-15"></a>               <span class="at">color   =</span> <span class="st">'black'</span>,</span>
<span id="cb124-16"><a href="#cb124-16"></a>               <span class="at">shape   =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb124-17"><a href="#cb124-17"></a>    <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">120</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb124-18"><a href="#cb124-18"></a>    <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">30</span> <span class="sc">/</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb124-19"><a href="#cb124-19"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb124-20"><a href="#cb124-20"></a>  <span class="fu">plot</span>(p)</span>
<span id="cb124-21"><a href="#cb124-21"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-110-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-110-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-110-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="chapter5_files/figure-html/unnamed-chunk-110-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="リスト-5-3-11" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-11">リスト 5-3-(11)</h4>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># Python </span></span>
<span id="cb125-2"><a href="#cb125-2"></a>M <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">10</span>)  <span class="co"># 調べるMの値、2から9</span></span>
<span id="cb125-3"><a href="#cb125-3"></a>sd_train <span class="op">=</span> np.zeros(<span class="bu">len</span>(M))</span>
<span id="cb125-4"><a href="#cb125-4"></a>sd_test <span class="op">=</span> np.zeros(<span class="bu">len</span>(M))</span>
<span id="cb125-5"><a href="#cb125-5"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(M)):</span>
<span id="cb125-6"><a href="#cb125-6"></a>    <span class="co"># wを計算</span></span>
<span id="cb125-7"><a href="#cb125-7"></a>    w <span class="op">=</span> fit_gauss_func(X_train, T_train, M[i])</span>
<span id="cb125-8"><a href="#cb125-8"></a>    <span class="co"># 訓練データのSDを計算</span></span>
<span id="cb125-9"><a href="#cb125-9"></a>    sd_train[i] <span class="op">=</span> np.sqrt(mse_gauss_func(X_train, T_train, w))</span>
<span id="cb125-10"><a href="#cb125-10"></a>    <span class="co"># テストデータのSDを計算</span></span>
<span id="cb125-11"><a href="#cb125-11"></a>    sd_test[i] <span class="op">=</span> np.sqrt(mse_gauss_func(X_test, T_test, w))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="co"># R</span></span>
<span id="cb126-2"><a href="#cb126-2"></a>M <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">9</span></span>
<span id="cb126-3"><a href="#cb126-3"></a>sd_train <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(M))</span>
<span id="cb126-4"><a href="#cb126-4"></a>sd_test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(M))</span>
<span id="cb126-5"><a href="#cb126-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb126-6"><a href="#cb126-6"></a>  w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(X_train, T_train, M[i])</span>
<span id="cb126-7"><a href="#cb126-7"></a>  sd_train[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mse_gauss_func</span>(X_train, T_train, w))</span>
<span id="cb126-8"><a href="#cb126-8"></a>  sd_test[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mse_gauss_func</span>(X_test, T_test, w))</span>
<span id="cb126-9"><a href="#cb126-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># Python</span></span>
<span id="cb127-2"><a href="#cb127-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb127-3"><a href="#cb127-3"></a>plt.plot(  <span class="co"># 訓練データのSD</span></span>
<span id="cb127-4"><a href="#cb127-4"></a>    M, sd_train, <span class="st">"black"</span>,</span>
<span id="cb127-5"><a href="#cb127-5"></a>    marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"-"</span>, </span>
<span id="cb127-6"><a href="#cb127-6"></a>    markerfacecolor<span class="op">=</span><span class="st">"white"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb127-7"><a href="#cb127-7"></a>    label<span class="op">=</span><span class="st">"training"</span>,</span>
<span id="cb127-8"><a href="#cb127-8"></a>)</span>
<span id="cb127-9"><a href="#cb127-9"></a>plt.plot(  <span class="co"># テストデータのSD</span></span>
<span id="cb127-10"><a href="#cb127-10"></a>    M, sd_test, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb127-11"><a href="#cb127-11"></a>    marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"-"</span>,</span>
<span id="cb127-12"><a href="#cb127-12"></a>    markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb127-13"><a href="#cb127-13"></a>    label<span class="op">=</span><span class="st">"test"</span>,</span>
<span id="cb127-14"><a href="#cb127-14"></a>)</span>
<span id="cb127-15"><a href="#cb127-15"></a>plt.legend(loc<span class="op">=</span><span class="st">"upper left"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb127-16"><a href="#cb127-16"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">12</span>)</span>
<span id="cb127-17"><a href="#cb127-17"></a>plt.grid()</span>
<span id="cb127-18"><a href="#cb127-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="co"># R</span></span>
<span id="cb128-2"><a href="#cb128-2"></a><span class="fu">tibble</span>(<span class="at">x_plt =</span> <span class="fu">c</span>(M, M),</span>
<span id="cb128-3"><a href="#cb128-3"></a>       <span class="at">y_plt =</span> <span class="fu">c</span>(sd_train, sd_test),</span>
<span id="cb128-4"><a href="#cb128-4"></a>       <span class="at">train_test =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'training'</span>, <span class="st">'test'</span>), <span class="at">each =</span> <span class="fu">length</span>(M))) <span class="sc">|&gt;</span></span>
<span id="cb128-5"><a href="#cb128-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt)) <span class="sc">+</span></span>
<span id="cb128-6"><a href="#cb128-6"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> train_test)) <span class="sc">+</span></span>
<span id="cb128-7"><a href="#cb128-7"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> train_test),</span>
<span id="cb128-8"><a href="#cb128-8"></a>             <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb128-9"><a href="#cb128-9"></a>  <span class="fu">xlim</span>(<span class="dv">2</span>, <span class="dv">9</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">1</span>, <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb128-10"><a href="#cb128-10"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">7</span> <span class="sc">/</span> <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb128-11"><a href="#cb128-11"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb128-12"><a href="#cb128-12"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb128-13"><a href="#cb128-13"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb128-14"><a href="#cb128-14"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-114-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-3-12" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-12">リスト 5-3-(12)</h4>
<p><strong>K 分割交差検証 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># Python</span></span>
<span id="cb129-2"><a href="#cb129-2"></a><span class="kw">def</span> kfold_gauss_func(x, t, m, k):</span>
<span id="cb129-3"><a href="#cb129-3"></a>    n <span class="op">=</span> x.shape[<span class="dv">0</span>]</span>
<span id="cb129-4"><a href="#cb129-4"></a>    mse_train <span class="op">=</span> np.zeros(k)</span>
<span id="cb129-5"><a href="#cb129-5"></a>    mse_test <span class="op">=</span> np.zeros(k)</span>
<span id="cb129-6"><a href="#cb129-6"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, k):</span>
<span id="cb129-7"><a href="#cb129-7"></a>        <span class="co"># 訓練データとテストデータに分割</span></span>
<span id="cb129-8"><a href="#cb129-8"></a>        <span class="co"># (A) テストデータのインデックス</span></span>
<span id="cb129-9"><a href="#cb129-9"></a>        i_test <span class="op">=</span> np.fmod(<span class="bu">range</span>(n), k)</span>
<span id="cb129-10"><a href="#cb129-10"></a>        x_test <span class="op">=</span> x[i_test <span class="op">==</span> i]   <span class="co"># テストデータ x</span></span>
<span id="cb129-11"><a href="#cb129-11"></a>        t_test <span class="op">=</span> t[i_test <span class="op">==</span> i]   <span class="co"># テストデータ t</span></span>
<span id="cb129-12"><a href="#cb129-12"></a>        x_train <span class="op">=</span> x[i_test <span class="op">!=</span> i]  <span class="co"># 訓練データ x</span></span>
<span id="cb129-13"><a href="#cb129-13"></a>        t_train <span class="op">=</span> t[i_test <span class="op">!=</span> i]  <span class="co"># 訓練データ t</span></span>
<span id="cb129-14"><a href="#cb129-14"></a>        <span class="co"># wを訓練データで決める</span></span>
<span id="cb129-15"><a href="#cb129-15"></a>        w <span class="op">=</span> fit_gauss_func(x_train, t_train, m)</span>
<span id="cb129-16"><a href="#cb129-16"></a>        <span class="co"># 訓練データのMSEを計算</span></span>
<span id="cb129-17"><a href="#cb129-17"></a>        mse_train[i] <span class="op">=</span> mse_gauss_func(x_train, t_train, w)</span>
<span id="cb129-18"><a href="#cb129-18"></a>        <span class="co"># テストデータのMSEを計算</span></span>
<span id="cb129-19"><a href="#cb129-19"></a>        mse_test[i] <span class="op">=</span> mse_gauss_func(x_test, t_test, w)</span>
<span id="cb129-20"><a href="#cb129-20"></a>    <span class="cf">return</span> mse_train, mse_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="co"># R</span></span>
<span id="cb130-2"><a href="#cb130-2"></a>kfold_gauss_func <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, m, k) {</span>
<span id="cb130-3"><a href="#cb130-3"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb130-4"><a href="#cb130-4"></a>  mse_train <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> k)</span>
<span id="cb130-5"><a href="#cb130-5"></a>  mse_test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> k)</span>
<span id="cb130-6"><a href="#cb130-6"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb130-7"><a href="#cb130-7"></a>    i_test <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n <span class="sc">%%</span> k</span>
<span id="cb130-8"><a href="#cb130-8"></a>    x_test <span class="ot">&lt;-</span> x[i_test <span class="sc">==</span> (i <span class="sc">-</span> <span class="dv">1</span>)] <span class="co"># Rのインデックスの都合上(i - 1)</span></span>
<span id="cb130-9"><a href="#cb130-9"></a>    t_test <span class="ot">&lt;-</span> t[i_test <span class="sc">==</span> (i <span class="sc">-</span> <span class="dv">1</span>)] </span>
<span id="cb130-10"><a href="#cb130-10"></a>    x_train <span class="ot">&lt;-</span> x[i_test <span class="sc">!=</span> (i <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb130-11"><a href="#cb130-11"></a>    t_train <span class="ot">&lt;-</span> t[i_test <span class="sc">!=</span> (i <span class="sc">-</span> <span class="dv">1</span>)]</span>
<span id="cb130-12"><a href="#cb130-12"></a>    w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(x_train, t_train, m)</span>
<span id="cb130-13"><a href="#cb130-13"></a>    mse_train[i] <span class="ot">&lt;-</span> <span class="fu">mse_gauss_func</span>(x_train, t_train, w)</span>
<span id="cb130-14"><a href="#cb130-14"></a>    mse_test[i] <span class="ot">&lt;-</span> <span class="fu">mse_gauss_func</span>(x_test, t_test, w)</span>
<span id="cb130-15"><a href="#cb130-15"></a>  }</span>
<span id="cb130-16"><a href="#cb130-16"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mse_train =</span> mse_train, <span class="at">mse_test =</span> mse_test)</span>
<span id="cb130-17"><a href="#cb130-17"></a>  <span class="fu">return</span>(res)</span>
<span id="cb130-18"><a href="#cb130-18"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rのインデックスの都合上，<code>i - 1</code>としている．</p>
</section>
<section id="リスト-5-3-13" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-13">リスト 5-3-(13)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a><span class="co"># Python</span></span>
<span id="cb131-2"><a href="#cb131-2"></a>np.fmod(<span class="bu">range</span>(<span class="dv">10</span>), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="co"># R</span></span>
<span id="cb132-2"><a href="#cb132-2"></a>(<span class="dv">0</span><span class="sc">:</span><span class="dv">9</span> <span class="sc">%%</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 1 2 3 4 0 1 2 3 4</code></pre>
</div>
</div>
<p>Rでmodの計算をするには，<code>%%</code>を用いるとよい．</p>
</section>
<section id="リスト-5-3-14" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-14">リスト 5-3-(14)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1"></a><span class="co"># Python</span></span>
<span id="cb134-2"><a href="#cb134-2"></a>M <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb134-3"><a href="#cb134-3"></a>K <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb134-4"><a href="#cb134-4"></a>kfold_gauss_func(X, T, M, K)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a><span class="co"># R</span></span>
<span id="cb135-2"><a href="#cb135-2"></a>M <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb135-3"><a href="#cb135-3"></a>K <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb135-4"><a href="#cb135-4"></a><span class="fu">kfold_gauss_func</span>(X, t, M, K)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mse_train
[1] 12.17729 19.10162 10.81234 12.22931

$mse_test
[1] 43.197351  9.237864 71.959691 49.144541</code></pre>
</div>
</div>
</section>
<section id="リスト-5-3-15" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-15">リスト 5-3-(15)</h4>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a><span class="co"># Python</span></span>
<span id="cb137-2"><a href="#cb137-2"></a>M <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">8</span>)</span>
<span id="cb137-3"><a href="#cb137-3"></a>K <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb137-4"><a href="#cb137-4"></a>Cv_Gauss_train <span class="op">=</span> np.zeros((K, <span class="bu">len</span>(M)))</span>
<span id="cb137-5"><a href="#cb137-5"></a>Cv_Gauss_test <span class="op">=</span> np.zeros((K, <span class="bu">len</span>(M)))</span>
<span id="cb137-6"><a href="#cb137-6"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(M)):</span>
<span id="cb137-7"><a href="#cb137-7"></a>    Cv_Gauss_train[:, i], Cv_Gauss_test[:, i] <span class="op">\</span></span>
<span id="cb137-8"><a href="#cb137-8"></a>        <span class="op">=</span> kfold_gauss_func(X, T, M[i], K)  <span class="co"># k分割交差検定</span></span>
<span id="cb137-9"><a href="#cb137-9"></a><span class="co"># 訓練データの各分割におけるMSEの平均、の平方根</span></span>
<span id="cb137-10"><a href="#cb137-10"></a>sd_Gauss_train <span class="op">=</span> np.sqrt(np.mean(Cv_Gauss_train, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb137-11"><a href="#cb137-11"></a><span class="co"># テストデータの各分割におけるMSEの平均、の平方根</span></span>
<span id="cb137-12"><a href="#cb137-12"></a>sd_Gauss_test <span class="op">=</span> np.sqrt(np.mean(Cv_Gauss_test, axis<span class="op">=</span><span class="dv">0</span>))</span>
<span id="cb137-13"><a href="#cb137-13"></a>np.save(<span class="st">"ch5_Gauss_test.npy"</span>, sd_Gauss_test)  <span class="co"># 結果の保存</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="co"># R</span></span>
<span id="cb138-2"><a href="#cb138-2"></a>M <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">7</span></span>
<span id="cb138-3"><a href="#cb138-3"></a>K <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb138-4"><a href="#cb138-4"></a>Cv_Gauss_train <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, <span class="fu">length</span>(M)))</span>
<span id="cb138-5"><a href="#cb138-5"></a>Cv_Gauss_test <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim =</span> <span class="fu">c</span>(K, <span class="fu">length</span>(M)))</span>
<span id="cb138-6"><a href="#cb138-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(M)) {</span>
<span id="cb138-7"><a href="#cb138-7"></a>  res <span class="ot">&lt;-</span> <span class="fu">kfold_gauss_func</span>(X, t, M[i], K)</span>
<span id="cb138-8"><a href="#cb138-8"></a>  Cv_Gauss_train[, i] <span class="ot">&lt;-</span> res<span class="sc">$</span>mse_train</span>
<span id="cb138-9"><a href="#cb138-9"></a>  Cv_Gauss_test[, i] <span class="ot">&lt;-</span> res<span class="sc">$</span>mse_test</span>
<span id="cb138-10"><a href="#cb138-10"></a>}</span>
<span id="cb138-11"><a href="#cb138-11"></a>sd_Gauss_train <span class="ot">&lt;-</span> <span class="fu">apply</span>(Cv_Gauss_train, <span class="dv">2</span>, mean) <span class="sc">|&gt;</span></span>
<span id="cb138-12"><a href="#cb138-12"></a>  <span class="fu">sqrt</span>()</span>
<span id="cb138-13"><a href="#cb138-13"></a>sd_Gauss_test <span class="ot">&lt;-</span> <span class="fu">apply</span>(Cv_Gauss_test, <span class="dv">2</span>, mean) <span class="sc">|&gt;</span></span>
<span id="cb138-14"><a href="#cb138-14"></a>  <span class="fu">sqrt</span>()</span>
<span id="cb138-15"><a href="#cb138-15"></a><span class="fu">save</span>(<span class="at">list =</span> <span class="st">'sd_Gauss_test'</span>, <span class="at">file =</span> <span class="st">'data/ch5_Gauss_test.Rdata'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a><span class="co"># Python</span></span>
<span id="cb139-2"><a href="#cb139-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb139-3"><a href="#cb139-3"></a><span class="co"># 訓練データに対するMSEのグラフ</span></span>
<span id="cb139-4"><a href="#cb139-4"></a>plt.plot(</span>
<span id="cb139-5"><a href="#cb139-5"></a>    M, sd_Gauss_train, <span class="st">"black"</span>,</span>
<span id="cb139-6"><a href="#cb139-6"></a>    marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"-"</span>, </span>
<span id="cb139-7"><a href="#cb139-7"></a>    markerfacecolor<span class="op">=</span><span class="st">"white"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb139-8"><a href="#cb139-8"></a>    label<span class="op">=</span><span class="st">"training"</span>,</span>
<span id="cb139-9"><a href="#cb139-9"></a>)</span>
<span id="cb139-10"><a href="#cb139-10"></a><span class="co"># テストデータに対するMSEのグラフ</span></span>
<span id="cb139-11"><a href="#cb139-11"></a>plt.plot(</span>
<span id="cb139-12"><a href="#cb139-12"></a>    M, sd_Gauss_test, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb139-13"><a href="#cb139-13"></a>    marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"-"</span>,</span>
<span id="cb139-14"><a href="#cb139-14"></a>    markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb139-15"><a href="#cb139-15"></a>    label<span class="op">=</span><span class="st">"test"</span>,</span>
<span id="cb139-16"><a href="#cb139-16"></a>)</span>
<span id="cb139-17"><a href="#cb139-17"></a>plt.legend(loc<span class="op">=</span><span class="st">"upper left"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb139-18"><a href="#cb139-18"></a>plt.ylim(<span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb139-19"><a href="#cb139-19"></a>plt.grid()</span>
<span id="cb139-20"><a href="#cb139-20"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="co"># R</span></span>
<span id="cb140-2"><a href="#cb140-2"></a><span class="fu">tibble</span>(<span class="at">x_plt =</span> <span class="fu">c</span>(M, M),</span>
<span id="cb140-3"><a href="#cb140-3"></a>       <span class="at">y_plt =</span> <span class="fu">c</span>(sd_Gauss_test, sd_Gauss_train),</span>
<span id="cb140-4"><a href="#cb140-4"></a>       <span class="at">col   =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'test'</span>, <span class="st">'train'</span>), <span class="at">each =</span> <span class="fu">length</span>(M))) <span class="sc">|&gt;</span></span>
<span id="cb140-5"><a href="#cb140-5"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt,</span>
<span id="cb140-7"><a href="#cb140-7"></a>                <span class="at">color =</span> col)) <span class="sc">+</span></span>
<span id="cb140-8"><a href="#cb140-8"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt,</span>
<span id="cb140-9"><a href="#cb140-9"></a>                 <span class="at">fill =</span> col),</span>
<span id="cb140-10"><a href="#cb140-10"></a>             <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb140-11"><a href="#cb140-11"></a>  <span class="fu">xlim</span>(<span class="dv">2</span>, <span class="dv">7</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">3</span>, <span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb140-12"><a href="#cb140-12"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">5</span> <span class="sc">/</span> <span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb140-13"><a href="#cb140-13"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb140-14"><a href="#cb140-14"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb140-15"><a href="#cb140-15"></a>                       <span class="at">label =</span> <span class="fu">c</span>(<span class="st">'test'</span>, <span class="st">'training'</span>)) <span class="sc">+</span></span>
<span id="cb140-16"><a href="#cb140-16"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb140-17"><a href="#cb140-17"></a>                      <span class="at">label =</span> <span class="fu">c</span>(<span class="st">'test'</span>, <span class="st">'training'</span>)) <span class="sc">+</span></span>
<span id="cb140-18"><a href="#cb140-18"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-124-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="リスト-5-3-16" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-3-16">リスト 5-3-(16)</h4>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1"></a><span class="co"># Python</span></span>
<span id="cb141-2"><a href="#cb141-2"></a>M <span class="op">=</span> <span class="dv">3</span>  <span class="co"># 最適なM=3に設定</span></span>
<span id="cb141-3"><a href="#cb141-3"></a>w <span class="op">=</span> fit_gauss_func(X, T, M)  <span class="co"># 全データでwを計算</span></span>
<span id="cb141-4"><a href="#cb141-4"></a>sd <span class="op">=</span> np.sqrt(mse_gauss_func(X, T, w))  <span class="co"># SDを計算</span></span>
<span id="cb141-5"><a href="#cb141-5"></a><span class="co"># 結果表示</span></span>
<span id="cb141-6"><a href="#cb141-6"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>sd<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="co"># R</span></span>
<span id="cb142-2"><a href="#cb142-2"></a>M <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># 最適なM=2に設定</span></span>
<span id="cb142-3"><a href="#cb142-3"></a>w <span class="ot">&lt;-</span> <span class="fu">fit_gauss_func</span>(X, t, M)</span>
<span id="cb142-4"><a href="#cb142-4"></a>sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mse_gauss_func</span>(X, t, w))</span>
<span id="cb142-5"><a href="#cb142-5"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">round</span>(sd, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 4.11</code></pre>
</div>
</div>
<p>リスト 5-3-(15)より，今回の最適な<code>M</code>は2であることがわかるので<code>M = 2</code>としている．</p>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1"></a><span class="co"># Python</span></span>
<span id="cb144-2"><a href="#cb144-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb144-3"><a href="#cb144-3"></a>show_gauss_func(w)</span>
<span id="cb144-4"><a href="#cb144-4"></a>plt.plot(</span>
<span id="cb144-5"><a href="#cb144-5"></a>    X, T, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb144-6"><a href="#cb144-6"></a>    marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb144-7"><a href="#cb144-7"></a>)</span>
<span id="cb144-8"><a href="#cb144-8"></a>plt.xlim(X_min, X_max)</span>
<span id="cb144-9"><a href="#cb144-9"></a>plt.grid()</span>
<span id="cb144-10"><a href="#cb144-10"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1"></a><span class="fu">show_gauss_func</span>(w) <span class="sc">+</span></span>
<span id="cb145-2"><a href="#cb145-2"></a>  <span class="fu">geom_point</span>(<span class="at">data    =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb145-3"><a href="#cb145-3"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb145-4"><a href="#cb145-4"></a>             <span class="at">color   =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb145-5"><a href="#cb145-5"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">130</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb145-6"><a href="#cb145-6"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">30</span> <span class="sc">/</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb145-7"><a href="#cb145-7"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'年齢x'</span>, <span class="at">y =</span> <span class="st">'身長t'</span>) <span class="sc">+</span></span>
<span id="cb145-8"><a href="#cb145-8"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> myf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-128-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="第4節" class="level3">
<h3 class="anchored" data-anchor-id="第4節">第4節</h3>
<section id="リセット-2" class="level4">
<h4 class="anchored" data-anchor-id="リセット-2">リセット</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1"></a><span class="co"># Python</span></span>
<span id="cb146-2"><a href="#cb146-2"></a><span class="op">%</span>reset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1"></a><span class="co"># R</span></span>
<span id="cb147-2"><a href="#cb147-2"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">setdiff</span>(<span class="fu">ls</span>(), <span class="st">'myf'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
注意
</div>
</div>
<div class="callout-body-container callout-body">
<p>フォントを指定している<code>myf</code>オブジェクトは消さない．</p>
</div>
</div>
</section>
<section id="リスト-5-4-1" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-4-1">リスト 5-4-(1)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1"></a><span class="co"># Python</span></span>
<span id="cb148-2"><a href="#cb148-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb148-3"><a href="#cb148-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1"></a><span class="co"># R</span></span>
<span id="cb149-2"><a href="#cb149-2"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>データのロード ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1"></a><span class="co"># Python</span></span>
<span id="cb150-2"><a href="#cb150-2"></a>data <span class="op">=</span> np.load(<span class="st">"ch5_data.npz"</span>)</span>
<span id="cb150-3"><a href="#cb150-3"></a>X <span class="op">=</span> data[<span class="st">"X"</span>]</span>
<span id="cb150-4"><a href="#cb150-4"></a>X_min <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb150-5"><a href="#cb150-5"></a>X_max <span class="op">=</span> data[<span class="st">"X_max"</span>]</span>
<span id="cb150-6"><a href="#cb150-6"></a>N <span class="op">=</span> data[<span class="st">"N"</span>]</span>
<span id="cb150-7"><a href="#cb150-7"></a>T <span class="op">=</span> data[<span class="st">"T"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1"></a><span class="co"># R</span></span>
<span id="cb151-2"><a href="#cb151-2"></a><span class="fu">load</span>(<span class="st">'data/ch5_data.Rdata'</span>)</span>
<span id="cb151-3"><a href="#cb151-3"></a>X_min <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>モデル A ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1"></a><span class="co"># Python</span></span>
<span id="cb152-2"><a href="#cb152-2"></a><span class="kw">def</span> model_A(x, w):</span>
<span id="cb152-3"><a href="#cb152-3"></a>    y <span class="op">=</span> w[<span class="dv">0</span>] <span class="op">-</span> w[<span class="dv">1</span>] <span class="op">*</span> np.exp(<span class="op">-</span>w[<span class="dv">2</span>] <span class="op">*</span> x)  <span class="co"># 式5-71</span></span>
<span id="cb152-4"><a href="#cb152-4"></a>    <span class="cf">return</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1"></a><span class="co"># R</span></span>
<span id="cb153-2"><a href="#cb153-2"></a>model_A <span class="ot">&lt;-</span> <span class="cf">function</span>(x, w) {</span>
<span id="cb153-3"><a href="#cb153-3"></a>  y <span class="ot">&lt;-</span> w[<span class="dv">1</span>] <span class="sc">-</span> w[<span class="dv">2</span>] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>w[<span class="dv">3</span>] <span class="sc">*</span> x)</span>
<span id="cb153-4"><a href="#cb153-4"></a>  <span class="fu">return</span>(y)</span>
<span id="cb153-5"><a href="#cb153-5"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>モデル A 表示 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1"></a><span class="co"># Python</span></span>
<span id="cb154-2"><a href="#cb154-2"></a><span class="kw">def</span> show_model_A(w):</span>
<span id="cb154-3"><a href="#cb154-3"></a>    x <span class="op">=</span> np.linspace(X_min, X_max, <span class="dv">100</span>)</span>
<span id="cb154-4"><a href="#cb154-4"></a>    y <span class="op">=</span> model_A(x, w)</span>
<span id="cb154-5"><a href="#cb154-5"></a>    plt.plot(x, y, <span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1"></a><span class="co"># R</span></span>
<span id="cb155-2"><a href="#cb155-2"></a>show_model_A <span class="ot">&lt;-</span> <span class="cf">function</span>(w) {</span>
<span id="cb155-3"><a href="#cb155-3"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(X_min, X_max, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb155-4"><a href="#cb155-4"></a>  y <span class="ot">&lt;-</span> <span class="fu">model_A</span>(x, w)</span>
<span id="cb155-5"><a href="#cb155-5"></a>  p <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> x, <span class="at">y_plt =</span> y) <span class="sc">|&gt;</span></span>
<span id="cb155-6"><a href="#cb155-6"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb155-7"><a href="#cb155-7"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt)) <span class="sc">+</span></span>
<span id="cb155-8"><a href="#cb155-8"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> myf)</span>
<span id="cb155-9"><a href="#cb155-9"></a>  <span class="fu">return</span>(p)</span>
<span id="cb155-10"><a href="#cb155-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>モデル A の平均二乗誤差(MSE) ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1"></a><span class="co"># Python</span></span>
<span id="cb156-2"><a href="#cb156-2"></a><span class="kw">def</span> mse_model_A(w, x, t):</span>
<span id="cb156-3"><a href="#cb156-3"></a>    y <span class="op">=</span> model_A(x, w)</span>
<span id="cb156-4"><a href="#cb156-4"></a>    mse <span class="op">=</span> np.mean((y <span class="op">-</span> t) <span class="op">**</span> <span class="dv">2</span>)  <span class="co"># 式5-72</span></span>
<span id="cb156-5"><a href="#cb156-5"></a>    <span class="cf">return</span> mse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1"></a><span class="co"># R</span></span>
<span id="cb157-2"><a href="#cb157-2"></a>mse_model_A <span class="ot">&lt;-</span> <span class="cf">function</span>(w, x, t) {</span>
<span id="cb157-3"><a href="#cb157-3"></a>  y <span class="ot">&lt;-</span> <span class="fu">model_A</span>(x, w)</span>
<span id="cb157-4"><a href="#cb157-4"></a>  mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((y <span class="sc">-</span> t) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb157-5"><a href="#cb157-5"></a>  <span class="fu">return</span>(mse)</span>
<span id="cb157-6"><a href="#cb157-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="リスト-5-4-2" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-4-2">リスト 5-4-(2)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1"></a><span class="co"># Python</span></span>
<span id="cb158-2"><a href="#cb158-2"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1"></a><span class="co"># R</span></span>
<span id="cb159-2"><a href="#cb159-2"></a><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rの最適化関数には<code>optimize()</code>と<code>optim()</code>がある．最適化したいパラメタが1つの場合は前者を，2つ以上の場合は後者を用いる．今回は，<code>w[1]</code>, <code>w[2]</code>, <code>w[3]</code>の3つのパラメタを求めたいため，<code>optim()</code>関数を用いる．</p>
<p><strong>モデル A のパラメータ最適化</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1"></a><span class="co"># Python</span></span>
<span id="cb160-2"><a href="#cb160-2"></a><span class="kw">def</span> fit_model_A(w_init, x, t):</span>
<span id="cb160-3"><a href="#cb160-3"></a>    res <span class="op">=</span> minimize(mse_model_A, w_init, args<span class="op">=</span>(x, t), method<span class="op">=</span><span class="st">"powell"</span>)</span>
<span id="cb160-4"><a href="#cb160-4"></a>    <span class="cf">return</span> res.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1"></a><span class="co"># R</span></span>
<span id="cb161-2"><a href="#cb161-2"></a>fit_model_A <span class="ot">&lt;-</span> <span class="cf">function</span>(w_init) {</span>
<span id="cb161-3"><a href="#cb161-3"></a>  res <span class="ot">&lt;-</span> <span class="fu">optim</span>(w_init,</span>
<span id="cb161-4"><a href="#cb161-4"></a>               <span class="at">fn =</span> <span class="cf">function</span>(w) {</span>
<span id="cb161-5"><a href="#cb161-5"></a>                 y <span class="ot">&lt;-</span> <span class="fu">model_A</span>(X, w)</span>
<span id="cb161-6"><a href="#cb161-6"></a>                 mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((y <span class="sc">-</span> t) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb161-7"><a href="#cb161-7"></a>                 <span class="fu">return</span>(mse)</span>
<span id="cb161-8"><a href="#cb161-8"></a>               }, <span class="at">method =</span> <span class="st">'CG'</span>)</span>
<span id="cb161-9"><a href="#cb161-9"></a>  <span class="fu">return</span>(res<span class="sc">$</span>par)</span>
<span id="cb161-10"><a href="#cb161-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>optim()</code>関数は，第一引数に求めたいパラメタの初期値を指定し，<code>fn</code>引数に関数を指定する．<code>fn</code>引数に指定する関数は引数を1つにしなければならない．引数を3つ持っている<code>mse_model_A()</code>関数は指定できないため，<code>optim()</code>関数内で改めて関数を定義している．</p>
<p>また，パウェルアルゴリズムは実装されていないため，共役勾配法を用いて最適化を行なっている．</p>
</section>
<section id="リスト-5-4-3" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-4-3">リスト 5-4-(3)</h4>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1"></a><span class="co"># Python</span></span>
<span id="cb162-2"><a href="#cb162-2"></a>w_init <span class="op">=</span> np.array([<span class="fl">100.0</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span>])  <span class="co"># wの初期値</span></span>
<span id="cb162-3"><a href="#cb162-3"></a>w <span class="op">=</span> fit_model_A(w_init, X, T)         <span class="co"># wを計算</span></span>
<span id="cb162-4"><a href="#cb162-4"></a>sd <span class="op">=</span> np.sqrt(mse_model_A(w, X, T))    <span class="co"># SDを計算</span></span>
<span id="cb162-5"><a href="#cb162-5"></a>果表示</span>
<span id="cb162-6"><a href="#cb162-6"></a><span class="bu">print</span>(<span class="ss">f"w0 = </span><span class="sc">{</span>w[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">, w1 = </span><span class="sc">{</span>w[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss">, w2 = </span><span class="sc">{</span>w[<span class="dv">2</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb162-7"><a href="#cb162-7"></a><span class="bu">print</span>(<span class="ss">f"SD = </span><span class="sc">{</span>sd<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1"></a><span class="co"># R</span></span>
<span id="cb163-2"><a href="#cb163-2"></a>w_init <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb163-3"><a href="#cb163-3"></a>w <span class="ot">&lt;-</span> <span class="fu">fit_model_A</span>(w_init)</span>
<span id="cb163-4"><a href="#cb163-4"></a>sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mse_model_A</span>(w, <span class="at">x =</span> X, <span class="at">t =</span> t))</span>
<span id="cb163-5"><a href="#cb163-5"></a><span class="fu">cat</span>(<span class="st">'w0 ='</span>, <span class="fu">round</span>(w[<span class="dv">1</span>], <span class="dv">2</span>), <span class="st">'w1 ='</span>, <span class="fu">round</span>(w[<span class="dv">2</span>], <span class="dv">2</span>), <span class="st">'w2 ='</span>, <span class="fu">round</span>(w[<span class="dv">3</span>], <span class="dv">2</span>))</span>
<span id="cb163-6"><a href="#cb163-6"></a><span class="fu">cat</span>(<span class="st">'SD ='</span>, <span class="fu">round</span>(sd, <span class="dv">2</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>w0 = 126.25 w1 = -26.25 w2 = -0.02</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>SD = 5.42 cm</code></pre>
</div>
</div>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1"></a><span class="co"># Python</span></span>
<span id="cb166-2"><a href="#cb166-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb166-3"><a href="#cb166-3"></a>show_model_A(w)</span>
<span id="cb166-4"><a href="#cb166-4"></a>plt.plot(</span>
<span id="cb166-5"><a href="#cb166-5"></a>  X, T, <span class="st">"cornflowerblue"</span>,</span>
<span id="cb166-6"><a href="#cb166-6"></a>  marker<span class="op">=</span><span class="st">"o"</span>, linestyle<span class="op">=</span><span class="st">"None"</span>, markeredgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb166-7"><a href="#cb166-7"></a>)</span>
<span id="cb166-8"><a href="#cb166-8"></a>plt.xlim(X_min, X_max)</span>
<span id="cb166-9"><a href="#cb166-9"></a>plt.grid()</span>
<span id="cb166-10"><a href="#cb166-10"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1"></a><span class="co"># R</span></span>
<span id="cb167-2"><a href="#cb167-2"></a><span class="fu">show_model_A</span>(w) <span class="sc">+</span></span>
<span id="cb167-3"><a href="#cb167-3"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x_plt =</span> X, <span class="at">y_plt =</span> t),</span>
<span id="cb167-4"><a href="#cb167-4"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt),</span>
<span id="cb167-5"><a href="#cb167-5"></a>             <span class="at">color =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb167-6"><a href="#cb167-6"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">30</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">140</span>, <span class="dv">180</span>) <span class="sc">+</span></span>
<span id="cb167-7"><a href="#cb167-7"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">30</span> <span class="sc">/</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb167-8"><a href="#cb167-8"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'年齢x'</span>, <span class="at">y =</span> <span class="st">'身長t'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-149-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>教科書とは曲線の形がやや異なるが，データにはフィットしていそうである．</p>
</section>
<section id="リスト-5-4-4" class="level4">
<h4 class="anchored" data-anchor-id="リスト-5-4-4">リスト 5-4-(4)</h4>
<p><strong>交差検証 モデル A ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1"></a><span class="co"># Python</span></span>
<span id="cb168-2"><a href="#cb168-2"></a><span class="kw">def</span> kfold_model_A(x, t, k):</span>
<span id="cb168-3"><a href="#cb168-3"></a>    n <span class="op">=</span> <span class="bu">len</span>(x)</span>
<span id="cb168-4"><a href="#cb168-4"></a>    mse_train <span class="op">=</span> np.zeros(k)</span>
<span id="cb168-5"><a href="#cb168-5"></a>    mse_test <span class="op">=</span> np.zeros(k)</span>
<span id="cb168-6"><a href="#cb168-6"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, k):</span>
<span id="cb168-7"><a href="#cb168-7"></a>        <span class="co"># 訓練データとテストデータに分割</span></span>
<span id="cb168-8"><a href="#cb168-8"></a>        i_test <span class="op">=</span> np.fmod(<span class="bu">range</span>(n), k)</span>
<span id="cb168-9"><a href="#cb168-9"></a>        x_test <span class="op">=</span> x[i_test <span class="op">==</span> i]</span>
<span id="cb168-10"><a href="#cb168-10"></a>        t_test <span class="op">=</span> t[i_test <span class="op">==</span> i]</span>
<span id="cb168-11"><a href="#cb168-11"></a>        x_train <span class="op">=</span> x[i_test <span class="op">!=</span> i]</span>
<span id="cb168-12"><a href="#cb168-12"></a>        t_train <span class="op">=</span> t[i_test <span class="op">!=</span> i]</span>
<span id="cb168-13"><a href="#cb168-13"></a>        <span class="co"># 精度を上げるため</span></span>
<span id="cb168-14"><a href="#cb168-14"></a>        <span class="co"># リスト5-4-(3)で得た値を初期値に設定</span></span>
<span id="cb168-15"><a href="#cb168-15"></a>        w_init <span class="op">=</span> np.array([<span class="fl">169.04</span>, <span class="fl">113.66</span>, <span class="fl">0.22</span>])</span>
<span id="cb168-16"><a href="#cb168-16"></a>        w <span class="op">=</span> fit_model_A(w_init, x_train, t_train)</span>
<span id="cb168-17"><a href="#cb168-17"></a>        mse_train[i] <span class="op">=</span> mse_model_A(w, x_train, t_train)</span>
<span id="cb168-18"><a href="#cb168-18"></a>        mse_test[i] <span class="op">=</span> mse_model_A(w, x_test, t_test)</span>
<span id="cb168-19"><a href="#cb168-19"></a>    <span class="cf">return</span> mse_train, mse_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1"></a><span class="co"># R</span></span>
<span id="cb169-2"><a href="#cb169-2"></a>kfold_model_A <span class="ot">&lt;-</span> <span class="cf">function</span>(x, t, k) {</span>
<span id="cb169-3"><a href="#cb169-3"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb169-4"><a href="#cb169-4"></a>  mse_train <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> k)</span>
<span id="cb169-5"><a href="#cb169-5"></a>  mse_test <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> k)</span>
<span id="cb169-6"><a href="#cb169-6"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb169-7"><a href="#cb169-7"></a>    i_test <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span>n <span class="sc">%%</span> k) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb169-8"><a href="#cb169-8"></a>    x_test <span class="ot">&lt;-</span> x[i_test <span class="sc">==</span> i]</span>
<span id="cb169-9"><a href="#cb169-9"></a>    t_test <span class="ot">&lt;-</span> t[i_test <span class="sc">==</span> i]</span>
<span id="cb169-10"><a href="#cb169-10"></a>    x_train <span class="ot">&lt;-</span> x[i_test <span class="sc">!=</span> i]</span>
<span id="cb169-11"><a href="#cb169-11"></a>    t_train <span class="ot">&lt;-</span> t[i_test <span class="sc">!=</span> i]</span>
<span id="cb169-12"><a href="#cb169-12"></a>    w_init <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">126.25</span>, <span class="sc">-</span><span class="fl">26.25</span>, <span class="sc">-</span><span class="fl">0.02</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb169-13"><a href="#cb169-13"></a>    w <span class="ot">&lt;-</span> <span class="fu">optim</span>(w_init,</span>
<span id="cb169-14"><a href="#cb169-14"></a>               <span class="at">fn =</span> <span class="cf">function</span>(w) {</span>
<span id="cb169-15"><a href="#cb169-15"></a>                 y <span class="ot">&lt;-</span> <span class="fu">model_A</span>(x_train, t_train)</span>
<span id="cb169-16"><a href="#cb169-16"></a>                 mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((y <span class="sc">-</span> t_train) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb169-17"><a href="#cb169-17"></a>                 <span class="fu">return</span>(mse)</span>
<span id="cb169-18"><a href="#cb169-18"></a>               },</span>
<span id="cb169-19"><a href="#cb169-19"></a>               <span class="at">method =</span> <span class="st">'CG'</span>)</span>
<span id="cb169-20"><a href="#cb169-20"></a>    mse_train[i] <span class="ot">&lt;-</span> <span class="fu">mse_model_A</span>(w<span class="sc">$</span>par, <span class="at">x =</span> x_train, <span class="at">t =</span> t_train)</span>
<span id="cb169-21"><a href="#cb169-21"></a>    mse_test[i] <span class="ot">&lt;-</span> <span class="fu">mse_model_A</span>(w<span class="sc">$</span>par, <span class="at">x =</span> x_test, <span class="at">t =</span> t_test)</span>
<span id="cb169-22"><a href="#cb169-22"></a>  }</span>
<span id="cb169-23"><a href="#cb169-23"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mse_train =</span> mse_train, <span class="at">mse_test =</span> mse_test))</span>
<span id="cb169-24"><a href="#cb169-24"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>メイン ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1"></a><span class="co"># Python</span></span>
<span id="cb170-2"><a href="#cb170-2"></a><span class="co"># model A の交差検定</span></span>
<span id="cb170-3"><a href="#cb170-3"></a>K <span class="op">=</span> <span class="dv">16</span></span>
<span id="cb170-4"><a href="#cb170-4"></a>Cv_A_train, Cv_A_test <span class="op">=</span> kfold_model_A(X, T, K)</span>
<span id="cb170-5"><a href="#cb170-5"></a>sd_A_test <span class="op">=</span> np.sqrt(np.mean(Cv_A_test))</span>
<span id="cb170-6"><a href="#cb170-6"></a><span class="co"># 線形基底関数モデルの交差検定の結果のロード</span></span>
<span id="cb170-7"><a href="#cb170-7"></a>sd_Gauss_test <span class="op">=</span> np.load(<span class="st">"ch5_Gauss_test.npy"</span>)</span>
<span id="cb170-8"><a href="#cb170-8"></a><span class="co"># 結果のまとめ</span></span>
<span id="cb170-9"><a href="#cb170-9"></a>SDs <span class="op">=</span> np.append(sd_Gauss_test[<span class="dv">0</span>:<span class="dv">5</span>], sd_A_test)</span>
<span id="cb170-10"><a href="#cb170-10"></a><span class="co"># 結果表示</span></span>
<span id="cb170-11"><a href="#cb170-11"></a><span class="bu">print</span>(<span class="ss">f"Gauss(M=3) SD = </span><span class="sc">{</span>sd_Gauss_test[<span class="dv">1</span>]<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span>
<span id="cb170-12"><a href="#cb170-12"></a><span class="bu">print</span>(<span class="ss">f"Model A SD = </span><span class="sc">{</span>sd_A_test<span class="sc">:.2f}</span><span class="ss"> cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1"></a><span class="co"># R</span></span>
<span id="cb171-2"><a href="#cb171-2"></a>K <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb171-3"><a href="#cb171-3"></a>Cv_A_res <span class="ot">&lt;-</span> <span class="fu">kfold_model_A</span>(X, t, K)</span>
<span id="cb171-4"><a href="#cb171-4"></a>Cv_A_train <span class="ot">&lt;-</span> Cv_A_res<span class="sc">$</span>mse_train; Cv_A_test <span class="ot">&lt;-</span> Cv_A_res<span class="sc">$</span>mse_test</span>
<span id="cb171-5"><a href="#cb171-5"></a>sd_A_test <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(Cv_A_test))</span>
<span id="cb171-6"><a href="#cb171-6"></a><span class="fu">load</span>(<span class="st">'data/ch5_Gauss_test.Rdata'</span>)</span>
<span id="cb171-7"><a href="#cb171-7"></a>SDs <span class="ot">&lt;-</span> <span class="fu">append</span>(sd_Gauss_test[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], sd_A_test)</span>
<span id="cb171-8"><a href="#cb171-8"></a><span class="fu">cat</span>(<span class="st">'Gauss (M = 3) SD ='</span>, sd_Gauss_test[<span class="dv">2</span>] <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="st">'cm'</span>)</span>
<span id="cb171-9"><a href="#cb171-9"></a><span class="fu">cat</span>(<span class="st">'Model A SD ='</span>, sd_A_test <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>), <span class="st">'cm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Gauss (M = 2) SD = 6.36 cm</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model A SD = 5.42 cm</code></pre>
</div>
</div>
<p><code>M = 2</code>を用いたため．</p>
<p><strong>グラフ描画 ———</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1"></a><span class="co"># Python</span></span>
<span id="cb174-2"><a href="#cb174-2"></a>M <span class="op">=</span> <span class="bu">range</span>(<span class="dv">6</span>)</span>
<span id="cb174-3"><a href="#cb174-3"></a>label <span class="op">=</span> [<span class="st">"M=2"</span>, <span class="st">"M=3"</span>, <span class="st">"M=4"</span>, <span class="st">"M=5"</span>, <span class="st">"M=6"</span>, <span class="st">"Model A"</span>]</span>
<span id="cb174-4"><a href="#cb174-4"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">3</span>))</span>
<span id="cb174-5"><a href="#cb174-5"></a>plt.bar(</span>
<span id="cb174-6"><a href="#cb174-6"></a>    M, SDs,facecolor<span class="op">=</span><span class="st">"cornflowerblue"</span>, align<span class="op">=</span><span class="st">"center"</span>, </span>
<span id="cb174-7"><a href="#cb174-7"></a>    tick_label<span class="op">=</span>label,</span>
<span id="cb174-8"><a href="#cb174-8"></a>)</span>
<span id="cb174-9"><a href="#cb174-9"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1"></a><span class="co"># R</span></span>
<span id="cb175-2"><a href="#cb175-2"></a>M <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb175-3"><a href="#cb175-3"></a>label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'M = 2'</span>, <span class="st">'M = 3'</span>, <span class="st">'M = 4'</span>, <span class="st">'M = 5'</span>, <span class="st">'M = 6'</span>, <span class="st">'Model A'</span>)</span>
<span id="cb175-4"><a href="#cb175-4"></a><span class="fu">tibble</span>(<span class="at">x_plt =</span> label, <span class="at">y_plt =</span> SDs) <span class="sc">|&gt;</span></span>
<span id="cb175-5"><a href="#cb175-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_plt, <span class="at">y =</span> y_plt)) <span class="sc">+</span></span>
<span id="cb175-6"><a href="#cb175-6"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>,</span>
<span id="cb175-7"><a href="#cb175-7"></a>           <span class="at">fill =</span> <span class="st">'cornflowerblue'</span>) <span class="sc">+</span></span>
<span id="cb175-8"><a href="#cb175-8"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">6</span> <span class="sc">/</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb175-9"><a href="#cb175-9"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">element_blank</span>(), <span class="at">y =</span> <span class="st">'SD'</span>) <span class="sc">+</span></span>
<span id="cb175-10"><a href="#cb175-10"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chapter5_files/figure-html/unnamed-chunk-156-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">機械学習に必要な数学の基本</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter6.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">教師あり学習 : 分類</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Copyright 2024, Keisuke Nakano</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>